!function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){!function(e){function n(t,r){if(!(this instanceof n))return new n(t,r);var o=this;i(o),o.q=o.c="",o.bufferCheckPosition=e.MAX_BUFFER_LENGTH,o.opt=r||{},o.opt.lowercase=o.opt.lowercase||o.opt.lowercasetags,o.looseCase=o.opt.lowercase?"toLowerCase":"toUpperCase",o.tags=[],o.closed=o.closedRoot=o.sawRoot=!1,o.tag=o.error=null,o.strict=!!t,o.noscript=!(!t&&!o.opt.noscript),o.state=H.BEGIN,o.strictEntities=o.opt.strictEntities,o.ENTITIES=Object.create(o.strictEntities?e.XML_ENTITIES:e.ENTITIES),o.attribList=[],o.opt.xmlns&&(o.ns=Object.create(M)),o.trackPosition=o.opt.position!==!1,o.trackPosition&&(o.position=o.line=o.column=0),p(o,"onready")}function r(t){for(var n=Math.max(e.MAX_BUFFER_LENGTH,10),r=0,i=0,o=I.length;o>i;i++){var s=t[I[i]].length;if(s>n)switch(I[i]){case"textNode":g(t);break;case"cdata":d(t,"oncdata",t.cdata),t.cdata="";break;case"script":d(t,"onscript",t.script),t.script="";break;default:m(t,"Max buffer length exceeded: "+I[i])}r=Math.max(r,s)}var a=e.MAX_BUFFER_LENGTH-r;t.bufferCheckPosition=a+t.position}function i(t){for(var e=0,n=I.length;n>e;e++)t[I[e]]=""}function o(t){g(t),""!==t.cdata&&(d(t,"oncdata",t.cdata),t.cdata=""),""!==t.script&&(d(t,"onscript",t.script),t.script="")}function s(t,e){return new a(t,e)}function a(t,e){if(!(this instanceof a))return new a(t,e);S.apply(this),this._parser=new n(t,e),this.writable=!0,this.readable=!0;var r=this;this._parser.onend=function(){r.emit("end")},this._parser.onerror=function(t){r.emit("error",t),r._parser.error=null},this._decoder=null,N.forEach(function(t){Object.defineProperty(r,"on"+t,{get:function(){return r._parser["on"+t]},set:function(e){return e?void r.on(t,e):(r.removeAllListeners(t),r._parser["on"+t]=e,e)},enumerable:!0,configurable:!1})})}function c(t){return t.split("").reduce(function(t,e){return t[e]=!0,t},{})}function u(t,e){return t.test(e)}function l(t,e){return t[e]}function f(t,e){return!u(t,e)}function h(t,e){return!l(t,e)}function p(t,e,n){t[e]&&t[e](n)}function d(t,e,n){t.textNode&&g(t),p(t,e,n)}function g(t){t.textNode=v(t.opt,t.textNode),t.textNode&&p(t,"ontext",t.textNode),t.textNode=""}function v(t,e){return t.trim&&(e=e.trim()),t.normalize&&(e=e.replace(/\s+/g," ")),e}function m(t,e){return g(t),t.trackPosition&&(e+="\nLine: "+t.line+"\nColumn: "+t.column+"\nChar: "+t.c),e=new Error(e),t.error=e,p(t,"onerror",e),t}function b(t){return t.sawRoot&&!t.closedRoot&&k(t,"Unclosed root tag"),t.state!==H.BEGIN&&t.state!==H.BEGIN_WHITESPACE&&t.state!==H.TEXT&&m(t,"Unexpected end"),g(t),t.c="",t.closed=!0,p(t,"onend"),n.call(t,t.strict,t.opt),t}function k(t,e){if("object"!=typeof t||!(t instanceof n))throw new Error("bad call to strictFail");t.strict&&m(t,e)}function y(t){t.strict||(t.tagName=t.tagName[t.looseCase]());var e=t.tags[t.tags.length-1]||t,n=t.tag={name:t.tagName,attributes:{}};t.opt.xmlns&&(n.ns=e.ns),t.attribList.length=0,d(t,"onopentagstart",n)}function T(t,e){var n=t.indexOf(":"),r=0>n?["",t]:t.split(":"),i=r[0],o=r[1];return e&&"xmlns"===t&&(i="xmlns",o=""),{prefix:i,local:o}}function x(t){if(t.strict||(t.attribName=t.attribName[t.looseCase]()),-1!==t.attribList.indexOf(t.attribName)||t.tag.attributes.hasOwnProperty(t.attribName))return void(t.attribName=t.attribValue="");if(t.opt.xmlns){var e=T(t.attribName,!0),n=e.prefix,r=e.local;if("xmlns"===n)if("xml"===r&&t.attribValue!==B)k(t,"xml: prefix must be bound to "+B+"\nActual: "+t.attribValue);else if("xmlns"===r&&t.attribValue!==U)k(t,"xmlns: prefix must be bound to "+U+"\nActual: "+t.attribValue);else{var i=t.tag,o=t.tags[t.tags.length-1]||t;i.ns===o.ns&&(i.ns=Object.create(o.ns)),i.ns[r]=t.attribValue}t.attribList.push([t.attribName,t.attribValue])}else t.tag.attributes[t.attribName]=t.attribValue,d(t,"onattribute",{name:t.attribName,value:t.attribValue});t.attribName=t.attribValue=""}function A(t,e){if(t.opt.xmlns){var n=t.tag,r=T(t.tagName);n.prefix=r.prefix,n.local=r.local,n.uri=n.ns[r.prefix]||"",n.prefix&&!n.uri&&(k(t,"Unbound namespace prefix: "+JSON.stringify(t.tagName)),n.uri=r.prefix);var i=t.tags[t.tags.length-1]||t;n.ns&&i.ns!==n.ns&&Object.keys(n.ns).forEach(function(e){d(t,"onopennamespace",{prefix:e,uri:n.ns[e]})});for(var o=0,s=t.attribList.length;s>o;o++){var a=t.attribList[o],c=a[0],u=a[1],l=T(c,!0),f=l.prefix,h=l.local,p=""===f?"":n.ns[f]||"",g={name:c,value:u,prefix:f,local:h,uri:p};f&&"xmlns"!==f&&!p&&(k(t,"Unbound namespace prefix: "+JSON.stringify(f)),g.uri=f),t.tag.attributes[c]=g,d(t,"onattribute",g)}t.attribList.length=0}t.tag.isSelfClosing=!!e,t.sawRoot=!0,t.tags.push(t.tag),d(t,"onopentag",t.tag),e||(t.state=t.noscript||"script"!==t.tagName.toLowerCase()?H.TEXT:H.SCRIPT,t.tag=null,t.tagName=""),t.attribName=t.attribValue="",t.attribList.length=0}function P(t){if(!t.tagName)return k(t,"Weird empty close tag."),t.textNode+="</>",void(t.state=H.TEXT);if(t.script){if("script"!==t.tagName)return t.script+="</"+t.tagName+">",t.tagName="",void(t.state=H.SCRIPT);d(t,"onscript",t.script),t.script=""}var e=t.tags.length,n=t.tagName;t.strict||(n=n[t.looseCase]());for(var r=n;e--;){var i=t.tags[e];if(i.name===r)break;k(t,"Unexpected close tag")}if(0>e)return k(t,"Unmatched closing tag: "+t.tagName),t.textNode+="</"+t.tagName+">",void(t.state=H.TEXT);t.tagName=n;for(var o=t.tags.length;o-->e;){var s=t.tag=t.tags.pop();t.tagName=t.tag.name,d(t,"onclosetag",t.tagName);var a={};for(var c in s.ns)a[c]=s.ns[c];var u=t.tags[t.tags.length-1]||t;t.opt.xmlns&&s.ns!==u.ns&&Object.keys(s.ns).forEach(function(e){var n=s.ns[e];d(t,"onclosenamespace",{prefix:e,uri:n})})}0===e&&(t.closedRoot=!0),t.tagName=t.attribValue=t.attribName="",t.attribList.length=0,t.state=H.TEXT}function w(t){var e,n=t.entity,r=n.toLowerCase(),i="";return t.ENTITIES[n]?t.ENTITIES[n]:t.ENTITIES[r]?t.ENTITIES[r]:(n=r,"#"===n.charAt(0)&&("x"===n.charAt(1)?(n=n.slice(2),e=parseInt(n,16),i=e.toString(16)):(n=n.slice(1),e=parseInt(n,10),i=e.toString(10))),n=n.replace(/^0+/,""),i.toLowerCase()!==n?(k(t,"Invalid character entity"),"&"+t.entity+";"):String.fromCodePoint(e))}function E(t,e){"<"===e?(t.state=H.OPEN_WAKA,t.startTagPosition=t.position):h(C,e)&&(k(t,"Non-whitespace before first tag."),t.textNode=e,t.state=H.TEXT)}function O(t,e){var n="";return e<t.length&&(n=t.charAt(e)),n}function F(t){var e=this;if(this.error)throw this.error;if(e.closed)return m(e,"Cannot write after close. Assign an onready handler.");if(null===t)return b(e);"object"==typeof t&&(t=t.toString());for(var n=0,i="";;){if(i=O(t,n++),e.c=i,!i)break;switch(e.trackPosition&&(e.position++,"\n"===i?(e.line++,e.column=0):e.column++),e.state){case H.BEGIN:if(e.state=H.BEGIN_WHITESPACE,"\ufeff"===i)continue;E(e,i);continue;case H.BEGIN_WHITESPACE:E(e,i);continue;case H.TEXT:if(e.sawRoot&&!e.closedRoot){for(var o=n-1;i&&"<"!==i&&"&"!==i;)i=O(t,n++),i&&e.trackPosition&&(e.position++,"\n"===i?(e.line++,e.column=0):e.column++);e.textNode+=t.substring(o,n-1)}"<"!==i||e.sawRoot&&e.closedRoot&&!e.strict?(!h(C,i)||e.sawRoot&&!e.closedRoot||k(e,"Text data outside of root node."),"&"===i?e.state=H.TEXT_ENTITY:e.textNode+=i):(e.state=H.OPEN_WAKA,e.startTagPosition=e.position);continue;case H.SCRIPT:"<"===i?e.state=H.SCRIPT_ENDING:e.script+=i;continue;case H.SCRIPT_ENDING:"/"===i?e.state=H.CLOSE_TAG:(e.script+="<"+i,e.state=H.SCRIPT);continue;case H.OPEN_WAKA:if("!"===i)e.state=H.SGML_DECL,e.sgmlDecl="";else if(l(C,i));else if(u(j,i))e.state=H.OPEN_TAG,e.tagName=i;else if("/"===i)e.state=H.CLOSE_TAG,e.tagName="";else if("?"===i)e.state=H.PROC_INST,e.procInstName=e.procInstBody="";else{if(k(e,"Unencoded <"),e.startTagPosition+1<e.position){var s=e.position-e.startTagPosition;i=new Array(s).join(" ")+i}e.textNode+="<"+i,e.state=H.TEXT}continue;case H.SGML_DECL:(e.sgmlDecl+i).toUpperCase()===D?(d(e,"onopencdata"),e.state=H.CDATA,e.sgmlDecl="",e.cdata=""):e.sgmlDecl+i==="--"?(e.state=H.COMMENT,e.comment="",e.sgmlDecl=""):(e.sgmlDecl+i).toUpperCase()===L?(e.state=H.DOCTYPE,(e.doctype||e.sawRoot)&&k(e,"Inappropriately located doctype declaration"),e.doctype="",e.sgmlDecl=""):">"===i?(d(e,"onsgmldeclaration",e.sgmlDecl),e.sgmlDecl="",e.state=H.TEXT):l(R,i)?(e.state=H.SGML_DECL_QUOTED,e.sgmlDecl+=i):e.sgmlDecl+=i;continue;case H.SGML_DECL_QUOTED:i===e.q&&(e.state=H.SGML_DECL,e.q=""),e.sgmlDecl+=i;continue;case H.DOCTYPE:">"===i?(e.state=H.TEXT,d(e,"ondoctype",e.doctype),e.doctype=!0):(e.doctype+=i,"["===i?e.state=H.DOCTYPE_DTD:l(R,i)&&(e.state=H.DOCTYPE_QUOTED,e.q=i));continue;case H.DOCTYPE_QUOTED:e.doctype+=i,i===e.q&&(e.q="",e.state=H.DOCTYPE);continue;case H.DOCTYPE_DTD:e.doctype+=i,"]"===i?e.state=H.DOCTYPE:l(R,i)&&(e.state=H.DOCTYPE_DTD_QUOTED,e.q=i);continue;case H.DOCTYPE_DTD_QUOTED:e.doctype+=i,i===e.q&&(e.state=H.DOCTYPE_DTD,e.q="");continue;case H.COMMENT:"-"===i?e.state=H.COMMENT_ENDING:e.comment+=i;continue;case H.COMMENT_ENDING:"-"===i?(e.state=H.COMMENT_ENDED,e.comment=v(e.opt,e.comment),e.comment&&d(e,"oncomment",e.comment),e.comment=""):(e.comment+="-"+i,e.state=H.COMMENT);continue;case H.COMMENT_ENDED:">"!==i?(k(e,"Malformed comment"),e.comment+="--"+i,e.state=H.COMMENT):e.state=H.TEXT;continue;case H.CDATA:"]"===i?e.state=H.CDATA_ENDING:e.cdata+=i;continue;case H.CDATA_ENDING:"]"===i?e.state=H.CDATA_ENDING_2:(e.cdata+="]"+i,e.state=H.CDATA);continue;case H.CDATA_ENDING_2:">"===i?(e.cdata&&d(e,"oncdata",e.cdata),d(e,"onclosecdata"),e.cdata="",e.state=H.TEXT):"]"===i?e.cdata+="]":(e.cdata+="]]"+i,e.state=H.CDATA);continue;case H.PROC_INST:"?"===i?e.state=H.PROC_INST_ENDING:l(C,i)?e.state=H.PROC_INST_BODY:e.procInstName+=i;continue;case H.PROC_INST_BODY:if(!e.procInstBody&&l(C,i))continue;"?"===i?e.state=H.PROC_INST_ENDING:e.procInstBody+=i;continue;case H.PROC_INST_ENDING:">"===i?(d(e,"onprocessinginstruction",{name:e.procInstName,body:e.procInstBody}),e.procInstName=e.procInstBody="",e.state=H.TEXT):(e.procInstBody+="?"+i,e.state=H.PROC_INST_BODY);continue;case H.OPEN_TAG:u(G,i)?e.tagName+=i:(y(e),">"===i?A(e):"/"===i?e.state=H.OPEN_TAG_SLASH:(h(C,i)&&k(e,"Invalid character in tag name"),e.state=H.ATTRIB));continue;case H.OPEN_TAG_SLASH:">"===i?(A(e,!0),P(e)):(k(e,"Forward-slash in opening tag not followed by >"),e.state=H.ATTRIB);continue;case H.ATTRIB:if(l(C,i))continue;">"===i?A(e):"/"===i?e.state=H.OPEN_TAG_SLASH:u(j,i)?(e.attribName=i,e.attribValue="",e.state=H.ATTRIB_NAME):k(e,"Invalid attribute name");continue;case H.ATTRIB_NAME:"="===i?e.state=H.ATTRIB_VALUE:">"===i?(k(e,"Attribute without value"),e.attribValue=e.attribName,x(e),A(e)):l(C,i)?e.state=H.ATTRIB_NAME_SAW_WHITE:u(G,i)?e.attribName+=i:k(e,"Invalid attribute name");continue;case H.ATTRIB_NAME_SAW_WHITE:if("="===i)e.state=H.ATTRIB_VALUE;else{if(l(C,i))continue;k(e,"Attribute without value"),e.tag.attributes[e.attribName]="",e.attribValue="",d(e,"onattribute",{name:e.attribName,value:""}),e.attribName="",">"===i?A(e):u(j,i)?(e.attribName=i,e.state=H.ATTRIB_NAME):(k(e,"Invalid attribute name"),e.state=H.ATTRIB)}continue;case H.ATTRIB_VALUE:if(l(C,i))continue;l(R,i)?(e.q=i,e.state=H.ATTRIB_VALUE_QUOTED):(k(e,"Unquoted attribute value"),e.state=H.ATTRIB_VALUE_UNQUOTED,e.attribValue=i);continue;case H.ATTRIB_VALUE_QUOTED:if(i!==e.q){"&"===i?e.state=H.ATTRIB_VALUE_ENTITY_Q:e.attribValue+=i;continue}x(e),e.q="",e.state=H.ATTRIB_VALUE_CLOSED;continue;case H.ATTRIB_VALUE_CLOSED:l(C,i)?e.state=H.ATTRIB:">"===i?A(e):"/"===i?e.state=H.OPEN_TAG_SLASH:u(j,i)?(k(e,"No whitespace between attributes"),e.attribName=i,e.attribValue="",e.state=H.ATTRIB_NAME):k(e,"Invalid attribute name");continue;case H.ATTRIB_VALUE_UNQUOTED:if(h(z,i)){"&"===i?e.state=H.ATTRIB_VALUE_ENTITY_U:e.attribValue+=i;continue}x(e),">"===i?A(e):e.state=H.ATTRIB;continue;case H.CLOSE_TAG:if(e.tagName)">"===i?P(e):u(G,i)?e.tagName+=i:e.script?(e.script+="</"+e.tagName,e.tagName="",e.state=H.SCRIPT):(h(C,i)&&k(e,"Invalid tagname in closing tag"),e.state=H.CLOSE_TAG_SAW_WHITE);else{if(l(C,i))continue;f(j,i)?e.script?(e.script+="</"+i,e.state=H.SCRIPT):k(e,"Invalid tagname in closing tag."):e.tagName=i}continue;case H.CLOSE_TAG_SAW_WHITE:if(l(C,i))continue;">"===i?P(e):k(e,"Invalid characters in closing tag");continue;case H.TEXT_ENTITY:case H.ATTRIB_VALUE_ENTITY_Q:case H.ATTRIB_VALUE_ENTITY_U:var a,c;switch(e.state){case H.TEXT_ENTITY:a=H.TEXT,c="textNode";break;case H.ATTRIB_VALUE_ENTITY_Q:a=H.ATTRIB_VALUE_QUOTED,c="attribValue";break;case H.ATTRIB_VALUE_ENTITY_U:a=H.ATTRIB_VALUE_UNQUOTED,c="attribValue"}";"===i?(e[c]+=w(e),e.entity="",e.state=a):u(e.entity.length?V:K,i)?e.entity+=i:(k(e,"Invalid character in entity name"),e[c]+="&"+e.entity+i,e.entity="",e.state=a);continue;default:throw new Error(e,"Unknown state: "+e.state)}}return e.position>=e.bufferCheckPosition&&r(e),e}e.parser=function(t,e){return new n(t,e)},e.SAXParser=n,e.SAXStream=a,e.createStream=s,e.MAX_BUFFER_LENGTH=65536;var I=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(t){function e(){}e.prototype=t;var n=new e;return n}),Object.keys||(Object.keys=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e}),n.prototype={end:function(){b(this)},write:F,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){o(this)}};var S;try{S=t("stream").Stream}catch(_){S=function(){}}var N=e.EVENTS.filter(function(t){return"error"!==t&&"end"!==t});a.prototype=Object.create(S.prototype,{constructor:{value:a}}),a.prototype.write=function(e){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(e)){if(!this._decoder){var n=t("string_decoder").StringDecoder;this._decoder=new n("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},a.prototype.end=function(t){return t&&t.length&&this.write(t),this._parser.end(),!0},a.prototype.on=function(t,e){var n=this;return n._parser["on"+t]||-1===N.indexOf(t)||(n._parser["on"+t]=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.splice(0,0,t),n.emit.apply(n,e)}),S.prototype.on.call(n,t,e)};var C="\r\n	 ",R="'\"",z=C+">",D="[CDATA[",L="DOCTYPE",B="http://www.w3.org/XML/1998/namespace",U="http://www.w3.org/2000/xmlns/",M={xml:B,xmlns:U};C=c(C);var j=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,G=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,K=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,V=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;R=c(R),z=c(z);var H=0;e.STATE={BEGIN:H++,BEGIN_WHITESPACE:H++,TEXT:H++,TEXT_ENTITY:H++,OPEN_WAKA:H++,SGML_DECL:H++,SGML_DECL_QUOTED:H++,DOCTYPE:H++,DOCTYPE_QUOTED:H++,DOCTYPE_DTD:H++,DOCTYPE_DTD_QUOTED:H++,COMMENT_STARTING:H++,COMMENT:H++,COMMENT_ENDING:H++,COMMENT_ENDED:H++,CDATA:H++,CDATA_ENDING:H++,CDATA_ENDING_2:H++,PROC_INST:H++,PROC_INST_BODY:H++,PROC_INST_ENDING:H++,OPEN_TAG:H++,OPEN_TAG_SLASH:H++,ATTRIB:H++,ATTRIB_NAME:H++,ATTRIB_NAME_SAW_WHITE:H++,ATTRIB_VALUE:H++,ATTRIB_VALUE_QUOTED:H++,ATTRIB_VALUE_CLOSED:H++,ATTRIB_VALUE_UNQUOTED:H++,ATTRIB_VALUE_ENTITY_Q:H++,ATTRIB_VALUE_ENTITY_U:H++,CLOSE_TAG:H++,CLOSE_TAG_SAW_WHITE:H++,SCRIPT:H++,SCRIPT_ENDING:H++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(t){var n=e.ENTITIES[t],r="number"==typeof n?String.fromCharCode(n):n;e.ENTITIES[t]=r});for(var q in e.STATE)e.STATE[e.STATE[q]]=q;H=e.STATE,String.fromCodePoint||!function(){var t=String.fromCharCode,e=Math.floor,n=function(){var n,r,i=16384,o=[],s=-1,a=arguments.length;if(!a)return"";for(var c="";++s<a;){var u=Number(arguments[s]);if(!isFinite(u)||0>u||u>1114111||e(u)!==u)throw RangeError("Invalid code point: "+u);65535>=u?o.push(u):(u-=65536,n=(u>>10)+55296,r=u%1024+56320,o.push(n,r)),(s+1===a||o.length>i)&&(c+=t.apply(null,o),o.length=0)}return c};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:n,configurable:!0,writable:!0}):String.fromCodePoint=n}()}("undefined"==typeof n?this.sax={}:n)},{stream:void 0,string_decoder:void 0}],2:[function(t){"undefined"!=typeof global?(global.KsanaCorpusBuilder=t("ksana-corpus-builder"),global.KsanaCorpus=t("ksana-corpus"),global.KsanaCorpusSearch=t("ksana-corpus-search"),global.KsanaCorpusROM=t("ksana-corpus-rom")):"undefined"!=typeof window&&(window.KsanaCorpusBuilder=t("ksana-corpus-builder"),window.KsanaCorpus=t("ksana-corpus"),window.KsanaCorpusSearch=t("ksana-corpus-search"),window.KsanaCorpusROM=t("ksana-corpus-rom"))},{"ksana-corpus":50,"ksana-corpus-builder":12,"ksana-corpus-rom":25,"ksana-corpus-search":36}],3:[function(t,e){const n=function(t){this.putGField("anchor",t)},r=function(t){const e=t.attributes.name||t.attributes.n;n.call(this,e)};e.exports={a:r,addAnchor:n}},{}],4:[function(t,e){var n=0;const r=function(t){const e=t.attributes.id||t.attributes.n;if(e){var r=e.split(/[\.p]/),i=parseInt(2==r.length?r[1]:r[0],10);1===i?this.addBook():i!==n+1&&this.log("error","wrong page number "+i+", prev:"+n),this._pb=i,this._pbline=0;const o=this.makeKPos(this.bookCount,i-1,0,0);this.setPos(o,this.tPos),n=i}};var i=0;const o=function(t,e,n,r,i,o){if(e){const s=this.substring(i,o);this.putArticle(s,n,r);const a=this.makeRange(n,this.kPos);this.putArticleField("rend","article",a)}},s=function(t,e){e||this.putEmptyArticleField("p")},a=function(t){const e=t.attributes.from;e?this.putArticleField("origin",e):console.error("origin missing from attribute")},c=function(t,e,n,r,i,o){if(e){const s=this.content.substring(i,o);this.putGroup(s,n,r)}},u=function(t,e,n){if(e){const r=this.makeRange(n,this.kPos);this.putArticleField("rend","tag",r)}},l=function(){};e.exports={p:s,pb:r,article:o,group:c,category:l,origin:a,tag:u,maxArticle:function(){return i}}},{}],5:[function(t,e){const n={jpeg:!0,png:!0},r=function(e,r,i){if(r){var o=(this.opts.path||"")+(e.attributes.n||e.attributes.f),s=e.attributes.n||e.attributes.f,a="",c=s.lastIndexOf("."),u=s.substr(c+1);if(c=s.lastIndexOf("/"),c>-1&&(s=s.substr(c+1)),"jpg"==u&&(u="jpeg"),!n[u])return void this.log("warn","unsupported image type "+u);if(this.opts.images&&this.opts.images[s]){var a=this.opts.images[s];const l=a.match&&a.match(/data.+?base64,/);a=l?a.substr(l[0].length):new Buffer(a).toString("base64")}if(!a){const f=t("fs");if(f&&f.existsSync&&f.existsSync(o)){const h=f.readFileSync(o);a=new Buffer(h).toString("base64")}}if(!a)return void this.log("warn","cannot find imagefile "+o);var p=this.makeRange(i-1,this.kPos);i==this.kPos&&(p=i),this.putArticleField(u,a,p)}};e.exports=r},{fs:void 0}],6:[function(t,e){var n={};const r=function(t,e){if(!e){const r=t.attributes.n;if(n[r]){const i=n[r];this.putArticleField("footnote",r+"	"+i),delete n[r]}else this.log("error","footnote "+r+" notfound")}},i=function(t){n=t},o=function(){return n},s=function(t,e){if(!e){const n=t.attributes.n;if(a[n])throw"note ptr exists"+n;a[t.attributes.n]=this.kPos}};var a={};const c=function(t,e,n,r,i,o){if(e){const s=(this.substring(i,o),t.attributes.n);if(!s)return void this.log("warn","釋 without n",this.stringify(this.kPos));const c=this.makeRange(n,this.kPos);if(ptrpos=a[s],!ptrpos)throw"no such ptr "+s;this.putField("note",c,ptrpos)}},u=function(t,e,n){return e?void 0:t.attributes.t?void this.putArticleField("rubynote",t.attributes.t,n):void this.log("warning","missing attribute t at"+this.stringify(n))};e.exports={ptr:s,def:c,footnote:r,setFootnotes:i,getFootnotes:o,rubynote:u}},{}],7:[function(t,e){var n=[],r={"檔":!0},i={"頁":!0,"段":!0,"註":!0,"釋":!0,RM:!0,RN:!0,P:!0,PB:!0,"圖":!0,IMAGE:!0,IMG:!0,"圖文字":!0};const o=function(t){if(i[t.name])return n;var e=t.attributes.t,o=t.attributes.l,s=!1,a=[];if(e){"."==e[e.length-1]&&(e=e.substr(0,e.length-1),s=!0),a=e.split(",");const c=n.indexOf(t.name);c>-1?n.length=c+1:n=[t.name],a.length&&(n=n.concat(a))}if(o&&(a=a.concat(o.split(","))),a)for(var u=0;u<a.length;u++)r[a[u]]=!0;const l=n.indexOf(t.name);return-1==l&&!r[t.name],n};e.exports=o},{}],8:[function(t,e){const n=function(t,e){for(var n,r=0;n=t[r];r++)if(n.name.indexOf("-corpus.json")>0){{var i=new FileReader;this.filename=n.name}return i.onload=function(t){try{const r=JSON.parse(t.target.result);e(0,r)}catch(t){e(n.name+" "+t.message)}},void i.readAsText(n,"UTF-8")}e&&e("Missing corpus configuration json.",null)},r=function(t){return t.match(/\.json$/)&&!t.match(/-corpus.json$/)},i=function(t){return t.match(/\.jpg/)||t.match(/\.png/)||t.match(/\.jepg/)},o=function(t,e){n.call(this,t,function(n,o){if(n)return void e(n);const s=[],a=[];for(var c,u=0;c=t[u];u++)s.push([c.name,u]);s.sort(function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:0});const l=s.map(function(t){return t[0]}),f=s.map(function(t){return t[1]});if(o.files){for(var c,u=0;c=o.files[u];u++){const h=l.indexOf(c);if(!(h>-1))return void e("file "+c+" not found in folder");a.push(t[f[h]])}const p=a.map(function(t){return t.name});for(var u=0;u<l.length;u++){const d=l[u];if((r(d)||i(d))&&-1==p.indexOf(d)){const h=l.indexOf(d);a.unshift(t[f[h]])}}}else for(var u=0;u<f.length;u++)a.push(t[f[u]]);e(0,a,o)})},s=function(t,e,n){if(!t)return void this.log("error","external fields not specified in -corpus json");try{const r=JSON.parse(n);for(var i in t)t[i]==e&&(t[i]=r)}catch(o){this.log("error",o.message)}},a=function(t,e,n){if(t instanceof Array){var r={};for(var i in t){var o=t[i],s=o.lastIndexOf("/");s>-1&&(o=o.substr(s+1)),r[o]=!1}t=r}return t[e]=n,t},c=function(t,e){var n=0,i=0,o=0,c=[];const u=function(t,e,n){this.onFileStart&&this.onFileStart.call(this,e,i),this.parser.addContent.call(this,t,e,n),this.onFileEnd&&this.onFileEnd.call(this,e,i),i++},l=this;l.opts.images||(l.opts.images={});for(var f,h=0;f=t[h];h++){var p=null;if(f.type.match("text/"))p="text";else if(r(f.name))p="json";else{if(!f.name.indexOf(!1)&&!f.name.indexOf(!1))continue;p="img"}n++;var d=!1;c.push(function(t,e){return function(){if(t.empty)return void tasks.shift();var n=new FileReader,r=l.filename=t.name;n.onload=function(t,e,n,r){return function(t){"text"==r?(d&&n.external&&(l.parser.loadExternals&&l.parser.loadExternals(l,n.external),d=!1),content=t.target.result.replace(/\r?\n/g,"\n").trim(),o+=content.length,u.call(l,content,e,n)):"json"==r?n.external&&(d=!0,s.call(l,n.external,e,t.target.result)):"img"==r&&(d=!0,n.images=a.call(l,n.images,e,t.target.result)),c.shift()()}}(t,r,l.opts,e),"img"==e?n.readAsDataURL(t):n.readAsText(t,l.opts.encoding||"UTF-8")}}(f,p))}c.push(function(){setTimeout(function(){e(0,l,o)},1)}),c.shift()({__empty:!0})};e.exports={addBrowserFiles:c,prepareHTMLFile:o}},{}],9:[function(t,e){const n=function(t){const e=t.shift(),n=e.type;for(var r=0;r<t.length;r++){const i=t[r].split("	"),o=i.shift(),s=this.parseRange(o),a=s.start==s.end?s.start:s.range,c=this.findArticle(a);c>=0&&this.putArticleField(n,i.join("	"),a,c)}};e.exports={importExternalMarkup:n}},{}],10:[function(t,e){const n=t("ksana-corpus").openCorpus;var r=0,i={},o=[],s=function(t){i[t]||(i[t]=0,r++),i[t]++},a=function(t){for(var e=t.join(),n=0;n<e.length;){var r=e.charCodeAt(n),i=e.charCodeAt(n+1);r>=19968&&40959>r&&(o[r-19968]||(o[r-19968]=0),o[r-19968]++,i>19968&&40959>i&&s(e[n]+e[n+1])),n++}},c=function(t){for(var e=0,n=0;n<t.length;n++){var r=Math.floor(100*n/t.length);r>e&&(process.stdout.write(r+"% [0G"),e=r),a(t[n])}},u=function(t){return o[t.charCodeAt(0)-19968]+o[t.charCodeAt(1)-19968]},l=function(t){var e=o.reduce(function(t,e){return t+e},0);console.log("token length",e);var n=t.reduce(function(t,e){return t+e[1]},0);console.log("bigram length",n),console.log("overhead",n/e)},f=function(e){console.log("bigramcount",r);var n=[];for(var s in i){var a=u(s),c=i[s]/a;n.push([s,i[s],o[s.charCodeAt(0)-19968],o[s.charCodeAt(1)-19968],c])}console.log("sorting"),n.sort(function(t,e){return e[1]-t[1]}),n=n.filter(function(t){return t[1]>e.minoccur}),console.log("writing"),t("fs").writeFileSync("bigrams.txt",n.join("\n"),"utf8"),l(n),n=n.map(function(t){return t[0]}),t("fs").writeFileSync("bigrams.js",'module.exports="'+n.join(" ")+'"',"utf8")},h=function(t,e){n(t,function(t,n){n.get(["texts"],{recursive:!0},function(t){console.log("loaded"),console.time("bigram"),c(t),console.timeEnd("bigram"),console.time("summary"),f({minoccur:e.minoccur||1e3}),console.timeEnd("summary")})})};e.exports=h},{fs:void 0,"ksana-corpus":50}],11:[function(t,e){const n=function(t,e,n,r,i,o){if(e){const s=this.substring(i,o).replace(/<.+?>/g,"");this.putArticle(s,n,r);const a=this.makeRange(n,this.kPos);this.putArticleField("rend","article",a)}},r=function(t,e,n,r,i,o){if(e){const s=this.substring(i,o).replace(/<.+?>/g,"");this.putGroup(s,n)}},i=function(t){const e=t.attributes.n;if(e&&-1!=e.indexOf(".")){var n=e.split(".");const r=n[0],i=n[1];var o=parseInt(r,10),s=parseInt(i,10);if(isNaN(o)&&(o=parseInt(r.substr(1),10)),1>o)throw console.log("negative page number, ",t.name,"n=",t.attributes.n),"negative page number";if(this.emitLine(),this._pb!==r&&1===o?this.addBook():1!=s&&s-this._pbline>1&&console.log("Gap at page ",o,"line ",s,",previous line",this._pbline),isNaN(o))throw"error page number "+r;if(this.bookCount){const a=this.makeKPos(this.bookCount,o-1,s-1,0);if(-1==a)throw"error lb "+t.attributes.n;this.newLine(a)}this._pb=r,this._pbline=s}};var o,s=[];const a=function(){this.putField("toc",s,o),this.putField("tocrange",this.kPos,o)},c=function(t,e){e?this._divdepth--:this._divdepth++};var u;const l=function(t,e,r,i,a,c){if(e){const l=this._divdepth;1==l&&(s.length&&(this.putField("toc",s,o),this.putField("tocrange",u.kpos,o),s=[]),o=r,this.opts.topDIVAsArticle&&n.call(this,t,e,r,i,a,c));var h=this.substring(a,c);h=h.replace(/<orig>.*?<\/orig>/g,"").replace(/<sic>.*?<\/sic>/g,""),h=h.replace(/<.+?>/g,"");const p=this.makeRange(r,this.kPos);var d=l;t.attributes.n&&(d+="\n"+t.attributes.n),this.putArticleField("head",d,p),u={depth:l,text:h,kpos:r},s.push(f(u))}},f=t("./tree").encodeTreeItem,h=function(t,e,n,r,i,o){if(e){var s=t.attributes.target||t.attributes.to;if(s||(s=this.substring(i,o)),!s||s.indexOf("@")>0)return;this.putArticleField("link",s,this.makeRange(n,this.kPos))}};e.exports={lb:i,article:n,articlegroup:r,link:h,div:c,head:l,head_finalize:a}},{"./tree":23}],12:[function(t,e){const n=t("ksana-corpus/ksanapos"),r=t("ksana-corpus/textutil"),i=t("./romable"),o=t("ksana-corpus/tokenizer"),s=t("ksana-corpus").regcor,a=t("./genbigram"),c=20170321,u=t("./inverted").createInverted,l=t("./externalmarkup").importExternalMarkup,f=o.createTokenizer,h=t("./reverselink").importLinks,p={xml:t("./parsexml"),htll:t("./parsehtll"),accelon3:t("./parseaccelon3"),pre:t("./parsepre")},d=function(e){if(e=e||{},e.id=e.id||e.name||"",!e.id)throw"missing corpus id";var a=e.bits?n.buildAddressPattern(e.bits,e.column):s[e.id]?s[e.id]:s["default"],d=n.makeKPos([1,0,0,0],a),v=0,m=!1,b=0,k=-1,y=0,T=0,x=[],A=e.tokenizerVersion||2,P=f(e.tokenizerVersion);P.TokenTypes.PUNC;var w=o.concreteToken,E=i({invertAField:e.invertAField}),O=null,F=!1,I={},S=[],_=[],N=0;const C=function(n){if(F)throw"cannot add file "+n+" after finalized";return t("fs").existsSync(n)?(this.onFileStart&&this.onFileStart.call(this,n,y),this.parser.addFile.call(this,n,e),this.emitLine(),this.onFileEnd&&this.onFileEnd.call(this,n,y),void y++):void(-1==n.indexOf("#")&&ft("error","file not found",n))},R=function(t,e,n){n=n||{},this.parser.setHandlers(this,t,e,n),this.onBookStart=n.bookStart,this.onBookEnd=n.bookEnd,this.onFileStart=n.fileStart,this.onFileEnd=n.fileEnd,this.onToken=n.onToken,this.onFinalize=n.finalize},z=function(t,e,n){if(n=n||this.kPos,"article"==t)throw"use putArticle";E.putField(t,e,n)},D=function(t,e,n){n=n||this.kPos,E.putGField(t,e,n)},L=function(t,e,r){r=r||this.kPos;const i=n.unpack(r,this.addressPattern);E.putField(t,e,r,i[0])},B=function(t,e){e=e||this.kPos,E.putField(t,null,e)},U=function(t,e){e=e||this.kPos;const r=n.unpack(e,this.addressPattern);E.putField(t,null,e,r[0])},M=function(t,e,n,r){n=n||this.kPos,E.putAField(t,e,n,r)},j=function(t,e,n){e=e||this.kPos,E.putAField(t,null,e,n)},G=function(t,e,i){e=e||this.kPos;const o=r.bookOf.call(this,e,this.addressPattern),s=r.bookOf.call(this,N);o>s&&(e=n.bookStartPos(e,this.addressPattern)),E.putArticle(t,e),O&&O.putArticle(i),N=e},K=function(t,e,n){e=e||this.kPos,n=n||this.tPos,E.putGField("group",t,e),O&&O.putGroup(n)},V=function(t){I[t]||(I[t]={}),I[t][this.articleCount-1]=!0},H=function(t){w[t[2]]&&v++,x.push(t)},q=function(t){if(t&&t.length&&m)for(var e=0;e<t.length;e++)H(t[e]);

},Y=function(t){const e=P.tokenize(t);this.addTokens(e)},J=function(){T&&(this.emitLine(),this.onBookEnd&&this.onBookEnd.call(this,T)),O&&O.putBookPos.call(this,T),T++,this.onBookStart&&this.onBookStart.call(this,T)},X=function(t,e,r,i,o){return o=o||a,n.makeKPos([t,e,r,i],o)},W=function(t,e,r){return r=r||a,n.makeRange(t,e,r)},Q=function(t){var e=n.unpack(t,a);return e[2]++,e[3]=0,n.makeKPos(e,a)},Z=function(t){d=t,v=0,k=t},$=function(t){for(var e=t.map(function(t){return t[0]}).join("");"\n"==e[0];)e=e.substr(1);for(;"\n"==e[e.length-1];)e=e.substr(0,e.length-1);return e},tt=function(){if(x.length){const t=$(x);if(v>a.maxchar){var e=n.stringify(this.kPos,a);_.push([this.kPos,e,t]),lineKCount=a.maxchar}E.putLine.call(this,t,d),b+=t.length,O&&O.putTokens(x),x=[]}},et=function(t){if(!(isNaN(t)||1>t)){if(k>t){var r=n.stringify(t,a),i=n.stringify(k,a);if(!e.randomPage)throw this.log("error",this.parser.line()),"line kpos must be larger the previous one. kpos:"+r+"prev "+i;S.push([t,r,k,i])}else this.emitLine(),O&&O.putLinePos.call(this,t);Z(t)}},nt=function(t){const e=n.unpack(t,this.addressPattern);return e[2]++,e[3]=0,n.makeKPos(e,this.addressPattern)},rt=function(){m=!0},it=function(){this.emitLine(),m=!1,this.bookcount&&this.onBookEnd&&this.onBookEnd.call(this)},ot=function(){for(var t in I)I[t]=Object.keys(I[t]).map(function(t){return parseInt(t,10)})},st=function(){var t={date:(new Date).toString()};return t.versions={tokenizer:A,builder:c},t.bits=a.bits,t.id=e.id||"unknown",e.article&&(t.article=e.article),a.column&&(t.column=a.column),e.language&&(t.language=e.language),e.invertAField&&(t.invertAField=e.invertAField),e.articleFields&&(t.articleFields=e.articleFields),e.removePunc&&(t.removePunc=e.removePunc),e.title&&(t.title=e.title),e.groupPrefix&&(t.groupPrefix=e.groupPrefix),e.groupColumn&&(t.groupColumn=e.groupColumn),e.displayOptions&&(t.displayOptions=e.displayOptions),ot(),e.linkTo?t.linkTo=Object.assign({},I,e.linkTo):Object.keys(I).length&&(t.linkTo=I),t.endpos=d+v,O&&(t.endtpos=O.tPos()),t},at=function(n,r){m&&it.call(this),this.onFinalize&&this.onFinalize.call(this),dt.parser.finalize&&dt.parser.finalize(dt,e),F=!0;const i=st.call(this);var o=null;try{o=E.buildROM(i,O)}catch(s){return void this.log("ERROR",s)}"undefined"!=typeof window&&console.log(o);var a=5*b+(e.extrasize||0);return 1e6>a&&(a=1e6),n||"undefined"==typeof Window?(t("./outputkdb").write(n,o,a,r),{rom:o,filename:n}):{rom:o,url:t("./outputkdb").writeToBlob(o,a,r)}},ct=function(t){return n.stringify(t,a)},ut=function(t,e){var n=a;return e&&(n=s[e]),n?r.parseRange(t,n):(this.log("ERROR","unknown corpus "+e),0)},lt=t("./handlers");var ft=function(){var t=Array.prototype.slice.call(arguments);"error"==t[0]?(t.shift(),console.error.apply(null,t)):"warn"==t[0]?console.warn.apply(null,t):console.log.apply(null,t)};const ht=function(t){this.log=t,this.parser.setLog&&this.parser.setLog(t),n.setLog&&n.setLog(t)},pt=function(t,e){return this.content.substring(t,e)},dt={tokenizer:P,substring:pt,emitLine:tt,setHandlers:R,nextLine:Q,importLinks:h,markBilink:V,addFile:C,addText:Y,addToken:H,addTokens:q,addBook:J,addBrowserFiles:g,putField:z,putGField:D,putEmptyField:B,putArticle:G,putArticleField:M,putEmptyArticleField:j,putGroup:K,parseRange:ut,putBookField:L,putEmptyBookField:U,handlers:lt,setPos:Z,newLine:et,nextLineStart:nt,stringify:ct,findArticle:E.findArticle,log:ft,setLog:ht,importExternalMarkup:l,makeKPos:X,makeRange:W,start:rt,romable:E,stop:it,writeKDB:at,openhandlers:{},closehandlers:{},otherhandlers:{}};if(Object.defineProperty(dt,"kPos",{get:function(){return d+v}}),Object.defineProperty(dt,"lineTokenCount",{get:function(){return v}}),Object.defineProperty(dt,"kPosH",{get:function(){return n.stringify(d+v,a)}}),Object.defineProperty(dt,"articleCount",{get:function(){return E.articleCount()}}),Object.defineProperty(dt,"fileCount",{get:function(){return y}}),Object.defineProperty(dt,"bookCount",{get:function(){return T}}),Object.defineProperty(dt,"addressPattern",{get:function(){return a}}),Object.defineProperty(dt,"started",{get:function(){return m}}),Object.defineProperty(dt,"disorderPages",{get:function(){return S}}),Object.defineProperty(dt,"longLines",{get:function(){return _}}),Object.defineProperty(dt,"id",{get:function(){return e.id}}),Object.defineProperty(dt,"opts",{get:function(){return e}}),O&&Object.defineProperty(dt,"tPos",{get:O.tPos}),O&&Object.defineProperty(dt,"totalPosting",{get:O.totalPosting}),e.inputFormat=e.inputFormat||"pre",dt.parser=p[e.inputFormat],!dt.parser)throw"unsupported input format "+e.inputFormat;dt.parser.initialize&&dt.parser.initialize(dt,e),dt._pb=0,dt._pbline=0;const gt=e.external&&"object"==typeof e.external.bigrams?e.external.bigrams:null;return O=e.textOnly?null:u({tokenizer:P,tokenizerVersion:A,addressPattern:a,bigrams:gt,removePunc:e.removePunc}),m="undefined"!=typeof e.autoStart?e.autoStart:!0,dt.newLine(d),dt},g=t("./browserfile").addBrowserFiles,v=t("./browserfile").prepareHTMLFile,m=function(t,e,n){v(t,function(t,r,i){if(t)return void n(t);const o=d(i);e&&o.setLog(e),o.setHandlers(),g.call(o,r,n)})},b=function(e,n){const r=t("fs");if(!r.existsSync|e)return void n(e+" not found");const i=r.readFileSync(e);var o=null;try{o=JSON.parse(i)}catch(s){return void n(s.message||s)}const a=e.match(/([^\/\\ ]+)-corpus\.json/);if(!a)return void n("invalid corpus json name:",e);corpusid=a[1];const c=t("path").dirname(e)+"/";o.path=c;const u=d(o);o.id||(o.id=corpusid);var l=[];o.files?l=o.files:(l=r.readdirSync(c),l=l.filter(function(t){return".xml"==t.substr(t.length-4)})),l.forEach(function(t){u.addFile(c+t)}),u.writeKDB(corpusid+".cor",function(t,e){n(0,t,e)})},k=function(t,e,r,i,o){return"string"==typeof o&&(o=s[o]),n.makeKPos([t,e,r,i],o)};e.exports={createCorpus:d,createCorpusFromJSON:b,createWebCorpus:m,makeKPos:k,genBigram:a}},{"./browserfile":8,"./externalmarkup":9,"./genbigram":10,"./handlers":11,"./inverted":13,"./outputkdb":16,"./parseaccelon3":17,"./parsehtll":18,"./parsepre":19,"./parsexml":20,"./reverselink":21,"./romable":22,fs:void 0,"ksana-corpus":50,"ksana-corpus/ksanapos":52,"ksana-corpus/textutil":55,"ksana-corpus/tokenizer":57,path:void 0}],13:[function(t,e){const n=function(t){const e=function(t){v[t]=y,y+=1e3},n=function(t){const e=Math.pow(2,addressPattern.charbits),n=Math.pow(2,addressPattern.rangebits);if(idx=Math.floor(t%n/e),book=Math.floor(t/n),!g[book]&&(g[book]=[],0!==idx))for(var r=idx;r>0;)g[book][--r]=y;g[book][idx]=y},r=function(t,e){d[t]||(d[t]=[]),d[t].push(e)},o=function(t,e){if(e==l.SPACE||e===l.PUNC&&h)return void(k=null);if(e==l.PUNC||e==l.NUMBER)return k=null,void y++;if("string"==typeof t)f&&f[k+t]&&(r(k+t,y-1),T++),r(t,y),T++;else for(var n=0;n<t.length;n++)f[k+t[n]]&&(T++,r(k+t[n],y-1)),r(t[n],y),T++;y++,k=t},s=function(t){for(i=0;i<t.length;i++){const e=t[i][2];o(t[i][0],e)}},a=function(t){t=t||y,m.push(t),y+=500},c=function(t){t=t||y,b.push(t)},u=function(){var t=[],e=[];for(var n in d)t.push([n,d[n]]);t.sort(function(t,e){return t[0]==e[0]?0:t[0]>e[0]?1:-1});for(var r=0;r<t.length;r++)e.push(t[r][1].length);var i=t.map(function(t){return t[0]}),o=t.map(function(t){return t[1]});d={};const s={tokens:i,postings:o,article2tpos:m,line2tpos:g,book2tpos:v,posting_length:e};return b.length&&(s.group2tpos=b),s},l=t.tokenizer.TokenTypes;var f,h,p={},d={},g={},v=[],m=[],b=[],k=null,y=1,T=0;return f=t.bigrams||null,addressPattern=t.addressPattern,p.tokenizer=t.tokenizer,p.tPos=function(){return y},p.totalPosting=function(){return T},p.putBookPos=e,p.putToken=o,p.putTokens=s,p.putArticle=a,p.putGroup=c,p.finalize=u,p.putLinePos=n,h=!!t.removePunc,p};e.exports={createInverted:n}},{}],14:[function(t,e){var n={uint8:"1",int32:"4",utf8:"8",ucs2:"2",bool:"^",blob:"&",utf8arr:"*",ucs2arr:"@",vint:"`",pint:"~",array:"",object:""},r=[],i=function(t,e){if(!t||0===t.length)return[];var n=[],i=0,o=0,s=0,a=0;do{if(s=t[i]||a,e&&(s-=a),0>s)throw console.log(t),console.trace("negative value at",i,"prev:",a,"now:",t[i],"key:",r),"negetive";for(n[o++]=s%128,s=Math.floor(s/128);s>0;)n[o++]=s%128|128,s=Math.floor(s/128);a=t[i]||a,i++}while(i<t.length);return n},o=function(t){t=t||{},t.size=t.size||134217728;var e=new Buffer(t.size),i=0,o=function(t,n){return e.write(t,n,t.length,"utf8"),n+t.length>i&&(i=n+t.length),t.length},s=function(t,n){return e.writeUInt8(Math.floor(t/4294967296),n),e.writeUInt32BE(4294967295&t,n+1),n+5>i&&(i=n+5),5},a=function(t,r,o){if(o=o||"ucs2",""==t)throw"cannot write null string";if("utf8"===o)e.write(n.utf8,r,1,"utf8");else{if("ucs2"!==o)throw"unsupported encoding "+o;e.write(n.ucs2,r,1,"utf8")}var s=Buffer.byteLength(t,o);return e.write(t,r+1,s,o),r+s+1>i&&(i=r+s+1),s+1},c=function(t,o,s){if(s=s||"ucs2","utf8"===s)e.write(n.utf8arr,o,1,"utf8");else{if("ucs2"!==s)throw"unsupported encoding "+s;e.write(n.ucs2arr,o,1,"utf8")}var a=t.join("\x00"),c=Buffer.byteLength(a,s);if(0===c)throw"empty string array "+JSON.stringify(r);return e.write(a,o+1,c,s),o+c+1>i&&(i=o+c+1),c+1},u=function(t,r){return e.write(n.int32,r,1,"utf8"),e.writeInt32BE(t,r+1),r+5>i&&(i=r+5),5},l=function(t,r){return e.write(n.uint8,r,1,"utf8"),e.writeUInt8(t,r+1),r+2>i&&(i=r+2),2},f=function(t,r){return e.write(n.bool,r,1,"utf8"),e.writeUInt8(Number(t),r+1),r+2>i&&(i=r+2),2},h=function(t,r){e.write(n.blob,r,1,"utf8"),t.copy(e,r+1);var o=t.length+1;return r+o>i&&(i=r+o),o},p=function(t,n,o){if(1===o)var s=e.writeUInt8;else{if(4!==o)throw"unsupported integer size";var s=e.writeInt32BE}if(!t.length)throw'empty fixed array"'+JSON.stringify(r)+'"';for(var a=0;a<t.length;a++)try{s.apply(e,[t[a],a*o+n])}catch(c){throw c}var u=o*t.length;return n+u>i&&(i=n+u),u};return this.writeI32=u,this.writeBool=f,this.writeBlob=h,this.writeUI8=l,this.writeString=a,this.writeSignature=o,this.writeOffset=s,this.writeStringArray=c,this.writeFixedArray=p,Object.defineProperty(this,"buf",{get:function(){return e}}),this},s=function(e){e=e||{};var s=new o(e),a=0,c={},u=function(t){var e=i(t,!1);s.writeFixedArray(e,a,1),a+=e.length},l=function(t){u([t])},f=function(t){var e=i(t,!0);s.writeFixedArray(e,a,1),a+=e.length},h=function(t,e){var r=a;a+=s.writeSignature(n.vint,a),u(t);var i=a-r;return T(e,i),i},p=function(t,e){var r=a;a+=s.writeSignature(n.pint,a),f(t);var i=a-r;return T(e,i),i},d=function(t,e){var n=s.writeUI8(t,a);return a+=n,T(e,n),n},g=function(t,e){var n=s.writeBool(t,a);return a+=n,T(e,n),n},v=function(t,e){var n=s.writeI32(t,a);return a+=n,T(e,n),n},m=function(t,e,n){n=n||O;var r=s.writeString(t,a,n);return a+=r,T(e,r),r},b=function(t,e,n){n=n||O,r.push(e);try{var i=s.writeStringArray(t,a,n)}catch(o){throw o}return a+=i,T(e,i),r.pop(),i},k=function(t,e){r.push(e);var n=s.writeBlob(t,a);return a+=n,T(e,n),r.pop(),n},y=[],T=function(t,e){var n=y[y.length-1];if(n&&(n.itemslength.push(e),"string"==typeof t)){if(!n.keys)throw"cannot have key in array";n.keys.push(t)}},x=function(t){var e=a,r=t.key||null,i=t.type||n.array;a+=s.writeSignature(i,a),a+=s.writeOffset(0,a);var o={type:i,key:r,start:e,datastart:a,itemslength:[]};i===n.object&&(o.keys=[]),y.push(o)},A=function(t){r.push(t),x({type:n.object,key:t})},P=function(t){r.push(t),x({type:n.array,key:t})},w=function(t,e,n){n.apply(c,[t,e])},E=function(){if(!y.length)throw"empty stack";var t=y.pop();s.writeOffset(a-t.datastart,t.datastart-5);var e=t.itemslength.length;return l(e),u(t.itemslength),t.type===n.object&&(a+=s.writeStringArray(t.keys,a,"utf8")),written=a-t.start,T(t.key,written),r.pop(),written},O="ucs2",F=function(t){return t?void(O=t):O},I=function(t){return t.length<5?N(t):"number"==typeof t[0]&&Math.round(t[0])==t[0]&&t[0]>=0?!0:!1},S=function(t){var e=0,n=1,r=1;if(t.length>t[t.length-1])return!1;if(1==t.length)return!0;var i=t.length;t.length>50&&(i=50);for(var o=1;i>o;o++)if(t[o]<t[o-1])return!1;for(;r<t.length;){if(r=e+n,t[e]>t[n])return!1;e=n,n=r}return!0},_=function(t){return t.normalArray?!1:t.length<5?C(t):"string"==typeof t[0]?!0:!1},N=function(t){for(var e=0;e<t.length;e++)if("number"!=typeof t[e]&&Math.round(t[e])!==t[e])return!1;return!0},C=function(t){for(var e=0;e<t.length;e++)if("string"!=typeof t[e])return!1;return!0},R=function(t,e,n){if(n=n||{},"null"==typeof t||"undefined"==typeof t)throw"cannot save null value of ["+e+"] folders"+JSON.stringify(y);var i=t.constructor.name;if("Object"===i){A(e);for(var o in t)R(t[o],o,n),n.autodelete&&delete t[o];E()}else if("Array"===i)if(I(t))t.sorted||S(t)?w(t,e,p):w(t,e,h);else if(_(t))b(t,e,t.enc);else{P(e);for(var o=0;o<t.length;o++){if(!t[o])throw console.error(t),"array has gap at "+o+" keys"+JSON.stringify(r);R(t[o],o,n),n.autodelete&&delete t[o]}E()}else if("String"===i)m(t,e);else if("Number"===i)t>=0&&256>t?d(t,e):v(t,e);else if("Boolean"===i)g(t,e);else{if("Buffer"!==i)throw"unsupported type "+i+" keys"+JSON.stringify(r);k(t,e)}return s.buf},z=function(){for(;y.length;)E();s.free()},D=function(){return a};Object.defineProperty(c,"size",{get:function(){return a}});var L=function(e,n,r){const i="fs";var o=t(i),a=c.currentsize(),u=0,l=0;("undefined"==typeof r||"function"==typeof n)&&(r=n),n=n||{},batchsize=n.batchsize||16777216,o.existsSync(e)&&o.unlinkSync(e);var f=function(t,e,n,r){return function(i){if(i)throw"write error"+i;n(t,e),l++,r()}},h=function(){if(p>l){var t=batchsize*l,n=t+batchsize;n>a&&(n=a);var i=s.buf.slice(t,n);u+=i.length,o.appendFile(e,i,f(a,u,r,h))}},p=1+Math.floor(c.size/batchsize);h()};return c.free=z,c.saveI32=v,c.saveUI8=d,c.saveBool=g,c.saveString=m,c.saveVInt=h,c.savePInt=p,c.saveInts=w,c.saveBlob=k,c.save=R,c.openArray=P,c.openObject=A,c.stringEncoding=F,c.close=E,c.writeFile=L,c.currentsize=D,c};e.exports=s},{}],15:[function(t,e){var n="",r=0;const i=function(){const t=this.tagstack.map(function(t){return t.tag.name+"#"+(t.line+1)});return t.join("/")},o=function(){const e=this.filename;var o=e;try{o=t("path").resolve(e)}catch(s){}"/"==o[0]&&(o=o.substr(1));var a=this.error.message.replace(/\n/g," "),c=0;a=a.replace(/(Line: )(\d+) /,function(t,e,n){return c=parseInt(n,10),isNaN(c)?e+n:""}),(n!=e||r!=c)&&(this.log(o+"("+(c+1)+"): "+a+(a.indexOf("close tag")>0?"  "+i.call(this):"")),n=e,r=c)};e.exports=o},{path:void 0}],16:[function(t,e){const n=t("./kdbw"),r=function(t,e,r){var i=n({size:e});const o=i.save(t),s=o.slice(0,i.currentsize()),a=new Blob([s],{type:"application/octet-stream"}),c=URL.createObjectURL(a);return r&&r(c,a.size),c},i=function(t,e,r,i){var o=n({size:r});o.save(e,null),o.writeFile(t,function(e,n){i&&e==n&&i(e,t)})};e.exports={write:i,writeToBlob:r}},{"./kdbw":14}],17:[function(t,e){const n=t("./accelon3handler/format"),r=t("./accelon3handler/note"),i=t("./accelon3handler/tree"),o=t("./accelon3handler/img"),s=t("./tree").encodeTreeItem,a=t("fs"),c=t("./parsepre");var u={"段":n.p,p:n.p,"頁":n.pb,"註":r.ptr,"釋":r.def,"圖":o};const l={"釋":r.def,"圖":o};var f=null,h=0,p=[],d=0;const g=function(t,e,n){const r=this;onopentag=function(t){const e=i.call(r,t),o=e.indexOf(t.name);if(o>-1){if(f)throw"nested Toc "+t.name+" line:"+parser.line;if(n.toc){const s=e.indexOf(n.toc);h=o>s?s:0}f={tag:t.name,kpos:r.kPos,depth:o,subtree:h}}},onclosetag=function(t){if(f&&t.tag.name==f.tag){const e=this.position-t.tag.name.length-3;if(f.text=r.substring(t.position,e),f.subtree){const n=f.depth-(f.subtree||0);r.putArticleField("head",n,r.makeRange(t.kpos,r.kPos)),r.putEmptyArticleField("p",t.kpos),p.push(s(f))}else p.length&&(r.putField("toc",p,d),r.putField("tocrange",r.kPos,d),p=[]),d=f.kpos;f=null}};const o=Object.assign({},n,{customHead:!0,onopentag:onopentag,onclosetag:onclosetag});c.addContent.call(this,t,e,o)},v=function(t,e){c.initialize(t,e),t.openhandlers=u,t.closehandlers=l;const r=e.schema||{};r.article&&(t.openhandlers[r.article]=n.article,t.closehandlers[r.article]=n.article),r.category&&(t.openhandlers[r.category]=n.category,t.closehandlers[r.category]=n.category),r.group&&(t.openhandlers[r.group]=n.group,t.closehandlers[r.group]=n.group)},m=function(t,e){const n=e.encoding||"utf8";var r=a.readFileSync(t,n);r=r.replace(/\r?\n/g,"\n").trim(),this.filename=t,g.call(this,r,t,e)};e.exports={addFile:m,addContent:g,setLog:c.setLog,initialize:v,setHandlers:c.setHandlers}},{"./accelon3handler/format":4,"./accelon3handler/img":5,"./accelon3handler/note":6,"./accelon3handler/tree":7,"./parsepre":19,"./tree":23,fs:void 0}],18:[function(t,e){const n=t("fs");var r,i=console.log,o=function(t,e,n,r){t.openhandlers=e||{},t.closehandlers=n||{},t.otherhandlers=r||{}},s=function(t,e){e.encoding||"utf8";var r=n.readFileSync(t,"utf8").replace(/\r?\n/g,"\n");this.filename=t,a.call(this,r,t,e)},a=function(t){var e,n,r=0,i="",o="",s=0;for(t=this.otherhandlers.onContent?this.otherhandlers.onContent(t):t;r<t.length;)if(e=t[r],"~"===e||"@"===e||"#"===e){for(this.addText(o),o="",i+=e,e=t[++r];r<t.length&&(e>="0"&&"9">=e||"."==e)||"\n"==e;)i+=e,e=t[++r];this.otherhandlers.onTag?this.otherhandlers.onTag.call(this,i):null,i=""}else if("^"===e){for(this.addText(o),o="",i+=e,e=t[++r];r<t.length&&"\n"!==e;)i+=e,e=t[++r];"\n"==e&&r++,this.otherhandlers.onTag?this.otherhandlers.onTag.call(this,i):null,i=""}else{if("\n"==e){this.addText(o),o="",n=this.popBaseText(),this.putLine(n);const s=this.nextLine(this.kPos);this.newLine(s,this.tPos)}else o+=e;r++}this.addText(o),n=this.popBaseText(),this.putLine(n)};const c=function(){return r},u=function(t){i=t};e.exports={addFile:s,addContent:a,setHandlers:o,line:c,setLog:u}},{fs:void 0}],19:[function(t,e){const n=t("fs"),r=t("./accelon3handler/format"),i=t("./accelon3handler/note"),o=t("./accelon3handler/anchor"),s=t("./accelon3handler/img"),a=t("./reverselink"),c=t("./handlers").link,u=t("./onerror");var l=console.log;const f=t("./tree").encodeTreeItem;var h,p={p:r.p,article:r.article,origin:r.origin,tag:r.tag,a:o.a,anchor:o.a,group:r.group,rubynote:i.rubynote,pb:r.pb,ptr:i.ptr,def:i.def,fn:i.footnote,footnote:i.footnote,fn:i.footnote,link:c,img:s};const d={def:i.def,article:r.article,group:r.group,tag:r.tag,link:c,img:s},g=function(t,e,n,r){t.openhandlers=Object.assign(t.openhandlers,e),t.closehandlers=Object.assign(t.closehandlers,n),t.otherhandlers=Object.assign(t.otherhandlers,r)};var v=null,m=0,b=[];const k=function(e,n,r){r=r||{};const i=t("sax");h=i.parser(!0),h.tagstack=[],h.log=l;var s="",c=0,p=this;p.content=e,h.filename=p.filename;const d=function(){if(s){const t=p.tokenizer.tokenize(s);for(var e=0;e<t.length;e++){const n=t[e];if("\n"!==n[0])this.addToken(n);else if(this._pb){if(0==this.lineTokenCount&&0==this._pbline)continue;const r=this.makeKPos(this.bookCount,this._pb-1,this._pbline+1,0);r&&(this.newLine(r,this.tPos),this._pbline++)}}tokens=[],s=""}};h.ontext=function(t){"<"!=t[0]&&(s+=t)},h.oncdata=function(t){d.call(p),p.putArticleField("cdata",t)},h.onopentag=function(t){d.call(p);const e={tag:t,kpos:p.kPos,tpos:p.tPos,position:this.position,line:this.line};this.tagstack.push(e);const n=p.openhandlers[t.name];if(r.customHead)r.onopentag&&r.onopentag.call(this,t);else{const i=t.name.match(/^[Hh]\d+/);if(i){const o=parseInt(t.name.substr(1),10);v={tag:t.name,kpos:p.kPos,text:"",depth:o,position:this.position}}}n&&n.call(p,t)&&(c++,e.capturing=!0)},h.onclosetag=function(t){d.call(p);const e=this.tagstack.pop(),n=e.tag,i=e.kpos,o=e.tpos,s=e.position,c=this.position-t.length-3,u=p.closehandlers[t];if(p.kPos>i&&e.tag.attributes.to&&a.add(p,i,e.tag,"a"),r.rendClass){const l=r.rendClass instanceof Array?r.rendClass.indexOf(t)>-1:r.rendClass(t);l&&p.putArticleField("rend",t,p.makeRange(i,p.kPos))}if(u?u.call(p,n,!0,i,o,s,c):p.otherhandlers.onclosetag&&p.otherhandlers.onclosetag.call(p,n,!0,i,o,s,c),r.customHead)r.onclosetag&&r.onclosetag.call(this,e);else if(r.toc==t&&(b.length&&(p.putField("toc",b,m),p.putField("tocrange",v.kpos,m),b=[]),m=p.kPos),v&&t==v.tag){var h=v.depth;v.text=p.content.substring(v.position,c);const g=n.attributes.n;g&&(h+="	"+g);const k=p.makeRange(v.kpos,p.kPos);p.putArticleField("head",h,k),b.push(f(v))}},h.onprocessinginstruction=function(t){o.addAnchor.call(p,t.name)},h.onerror=u,h.write(e)},y=function(t,e){const r=e.encoding||"utf8";var i=n.readFileSync(t,r);i=i.replace(/\r?\n/g,"\n").trim(),this.filename=t,k.call(this,i,t,e)},T=function(){return h.line},x=function(t,e){e.footnotes&&i.setFootnotes(e.footnotes)},A=function(t,e){var r={};if(e.images&&n&&n.existsSync){for(var o=0;o<e.images.length;o++){const s=e.path+e.images[o];if(n.existsSync(s)){var a=e.images[o].lastIndexOf("/"),c=s;a>1&&(c=e.images[o].substr(a+1)),r[c]=n.readFileSync(s)}}e.images=r}if(e.external&&n&&n.existsSync)try{for(var u in e.external){const s=e.path+e.external[u];n.existsSync(s)&&(e.external[u]=JSON.parse(n.readFileSync(s,"utf8")))}if(e.external.footnotes&&i.setFootnotes(e.external.footnotes),e.external.bigrams&&"string"==typeof e.external.bigrams){const l={};e.external.bigrams.split(" ").forEach(function(t){l[t]=!0}),e.external.bigrams=l}}catch(f){this.log(f)}e.toc||(e.toc="article"),t.openhandlers=p,t.closehandlers=d,t._pbline=0,t._pb=0},P=function(t,e){if(e.external&&e.external.footnotes){const n=i.getFootnotes(e.external.footnotes),r=Object.keys(n);r.length&&t.log("warn","unconsumed footnotes:",r.join(",").substring(0,500))}b.length&&(t.putField("toc",b,m),t.putField("tocrange",t.kPos,m))},w=function(t){l=t};e.exports={addFile:y,addContent:k,setHandlers:g,line:T,initialize:A,loadExternals:x,finalize:P,setLog:w}},{"./accelon3handler/anchor":3,"./accelon3handler/format":4,"./accelon3handler/img":5,"./accelon3handler/note":6,"./handlers":11,"./onerror":15,"./reverselink":21,"./tree":23,fs:void 0,sax:1}],20:[function(t,e){const n=t("sax"),r=t("fs");var i,o=console.log;const s=t("./handlers"),a=t("./accelon3handler/format");var c={article:s.article,articlegroup:s.articlegroup,p:a.p,lb:s.lb,head:s.head,div:s.div};const u={div:s.div,head:s.head,article:s.article,articlegroup:s.articlegroup},l=t("./onerror"),f=function(t,e,n,r){t.openhandlers=Object.assign(t.openhandlers,e),t.closehandlers=Object.assign(t.closehandlers,n),t.otherhandlers=Object.assign(t.otherhandlers,r)},h=function(t){i=n.parser(!0),i.tagstack=[];var e="",r=0,s=this;i.filename=s.filename,i.log=o,s.content=t;const a=function(){const t=s.tokenizer.tokenize(e);s.addTokens(t),e=""};i.ontext=function(t){r||(e+=t)},i.onopentag=function(t){a.call(this);var e={tag:t,kpos:s.kPos,tpos:s.tPos,position:this.position};this.tagstack.push(e);const n=s.openhandlers[t.name];s.position=this.position,n&&n.call(s,t)&&(r++,e.capturing=!0)},i.onclosetag=function(t){const e=this.tagstack.pop(),n=e.tag,i=e.kpos,o=e.tpos,c=e.position,u=s.closehandlers[t],l=this.position-t.length-3;r||a.call(this),n.attributes.rend&&i<this.kPos&&this.putArticleField("rend",n.attributes.rend,this.makeRange(i,this.kPos)),u?u.call(s,n,!0,i,o,c,l):s.otherhandlers.onclosetag&&s.otherhandlers.onclosetag.call(s,n,!0,i,o,c,l),e.capturing&&r--},i.onerror=l,i.write(t)},p=function(t,e){const n=e.encoding||"utf8";var i=r.readFileSync(t,n).replace(/\r?\n/g,"\n").trim();this.filename=t,h.call(this,i,t,e)},d=function(){return i.line},g=function(t){o=t},v=function(t){t._divdepth=0,t.openhandlers=c,t.closehandlers=u},m=function(t){s.head_finalize.call(t)};e.exports={addFile:p,addContent:h,setHandlers:f,setLog:g,line:d,initialize:v,finalize:m}},{"./accelon3handler/format":4,"./handlers":11,"./onerror":15,fs:void 0,sax:1}],21:[function(t,e){const n="<",r=function(t,e,r){var i=t.id,o=r.attributes.to;const s=o.match(/(.+)@(.+)/);s&&(i=s[1],o=s[2]);const a=t.parseRange(o,i!==t.id?i:null),c=r.name+n+i;t.putGField(c,a.range?a.range:o,t.makeRange(e,t.kPos)),i!==t.id&&t.markBilink(c)},i=function(t,e,n){for(var r={},i=0;i<e.length;i++){const o=e[i].split("	");var s=this.parseRange(o[0]).range,a=this.findArticle(s);if(0>a)this.log("ERROR","invalid address "+o[0]);else{r[a]=!0;var c=o[1];parseInt(c,10).toString(10)==c&&(c=parseInt(c,10));const u=this.parseRange(c,n);u&&u.range&&(c=u.range),this.putGField(t,c,s,a)}}return Object.keys(r).map(function(t){return parseInt(t,10)}).sort(function(t,e){return t-e})};e.exports={add:r,importLinks:i}},{}],22:[function(t,e){var n=t("ksana-corpus/ksanapos"),r=t("ksana-corpus/bsearch");const i=function(t){t=t||{};var e={},i={},o={},s=[],a=0;const c=function(t,e,n,r){"undefined"!=typeof r?(i[t]||(i[t]={}),i[t][r]||(i[t][r]=[]),i[t][r].push([n,e])):(i[t]||(i[t]=[]),i[t].push([n,e]))},u=function(t,n,r){e[t]||(e[t]=[]),e[t].push([r,n])},l=function(t,e){a++,f=null,u("article",t,e)};var f=null,h=null;const p=function(t){var i=t;const o=this.addressPattern;"string"==typeof t&&(i=n.parse(t,o));const s=n.breakRange(i,o);f||(f=[],h=[],e.article.forEach(function(t){f.push(t[0]),h.push(t[1])}));var a=r(f,s.start+1,!0)-1;return a},d=function(t,e,n,r){var i=r;i||"number"==typeof i||(i=a-1),0>i||(o[i]||(o[i]={}),o[i][t]||(o[i][t]=[]),o[i][t].push([n,e]))},g=function(t,e){return"undefined"!=typeof e?i[t][e]:i[t]},v=function(t){return i[t]},m=function(t,e){return"undefined"!=typeof e?i[t][e]:i[t]},b=function(){return o},k=function(t,e){var r=n.unpack(e,this.addressPattern);const i=r[0]-1,o=r[1],a=r[2];s[i]||(s[i]=[]),s[i][o]||(s[i][o]=[]);const c=r[1];for(var u=c-1;u>=0&&!s[i][u];)s[i][u--]=[" "];t||a||(t=" ");for(var l=a-1;l>=0&&!s[i][o][l];)s[i][o][l]=" ",l--;s[i][o][a]=t},y=function(t,e,n,r){"startend_unsorted"==r&&(c(t+"_start",n[0],e[0]),c(t+"_end",n[n.length-1],e[e.length-1]))},T=function(){for(var t=0;t<s.length;t++){const e=s[t];if(!e)throw"empty book"+(t+1);for(var n=0;n<e.length;n++)for(const r=e[n];r.length>1&&""==r[r.length-1].trim();)r.pop()}return s},x=function(){for(article in o){const e=o[article];for(name in e){const n=e[name];var r=[],i=[];for(hasvalue=null!==n[0][1],n.sort(function(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}),j=0;j<n.length;j++)r.push(n[j][0]),hasvalue&&i.push(n[j][1]);e[name]={pos:r},i.length&&(e[name].value=i),t.invertAField&&t.invertAField[name]&&y(name,r,i,t.invertAField[name])}}return o},A=function(t){var e,n,r,i,o;for(e in t){var s=[],a=[],c=t[e];if(c instanceof Array){for(o=null!==c[0][1],c.sort(function(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}),n=0;n<c.length;n++)s.push(c[n][0]),o&&a.push(c[n][1]);t[e]={pos:s},a.length&&(t[e].value=a)}else for(r in c){for(i=c[r],s=[],a=[],o=null!==i[0][1],i.sort(function(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}),n=0;n<i.length;n++)s.push(i[n][0]),o&&a.push(i[n][1]);c[r]={pos:s},a.length&&(c[r].value=a)}}return t},P=function(t,n){const r=x(),o=A(i),s=A(e),a=T(),c={meta:t,texts:a};if(n&&(c.inverted=n.finalize()),Object.keys(o).length&&(c.fields=o),c.gfields=s,Object.keys(r).length&&(c.afields=r),!e.article)throw"missing article";if(n&&!c.inverted.book2tpos)throw"missing pb";return c};return{putLine:k,putArticle:l,articleCount:function(){return a},putField:c,putAField:d,putGField:u,getAField:m,getAFields:b,getField:g,getGField:v,buildROM:P,findArticle:p}};e.exports=i},{"ksana-corpus/bsearch":42,"ksana-corpus/ksanapos":52}],23:[function(t,e){const n=function(t){return t.depth-(t.subtree||0)+"	"+t.text+"	"+t.kpos.toString(36)},r=function(t){const e=t.split("	");return{depth:e[0],text:e[1],kpos:parseInt(e[2],36)}};e.exports={encodeTreeItem:n,decodeTreeItem:r}},{}],24:[function(t,e){function n(t){console.error("Error: "+t.name+" "+t.message)}var r=function(t,e){var n=new FileReader;n.onload=function(){e(n.result.length)},n.readAsDataURL(t)},i=function(t,e){var n=new XMLHttpRequest;const r=0==t.indexOf("http")?"?"+(new Date).getTime():"";n.open("HEAD",t+r,!0),n.onload=function(t){var r=parseInt(n.getResponseHeader("Content-Length"));isNaN(r)&&(r=t.total),setTimeout(function(){this.status>200?e(1,"invalid url"):e(0,r)}.bind(this),0)},n.send()},o=function(){},s=function(){throw"not implement yet"},a=function(){throw"not implement yet"},c=function(t,e){var n={};n.url=URL.createObjectURL(t),n.fn=t.name.substr(t.name.indexOf("#")+1),n.file=t,e(n)},u=function(t,e){var n={};n.url=t.replace(/#.*/,"");const r=t.match(/#(.+)\*(\d+)/);n.fn=r[1],n.blobsize=parseInt(r[2]),e(n)},l=function(t,e){var n={};n.url=t,n.fn=t.substr(t.lastIndexOf("/")+1),e(n)},f=function(t,e){var n={};if(0==t.indexOf("filesystem:"))n.url=t,n.fn=t.substr(t.lastIndexOf("/")+1);else{n.fn=t;var r=b.files.filter(function(e){return e[0]==t});r.length?n.url=r[0][1]:e(null)}e(n)},h=function(t,e){return"undefined"!=typeof File&&t.constructor===File?void c.call(this,t,e):0==t.indexOf("blob:")?void u.call(this,t,e):0==t.indexOf("http")||0==t.indexOf("chrome-extension:")?void l.call(this,t,e):void(b.initialized?f.apply(this,[t,e]):g(1048576,function(n,r){return r?void f.apply(this,[t,e]):void e(null)},this))},p=function(t,e){var n=b.fs.root.createReader(),r=[];n.readEntries(function(n){if(n.length)for(var i,o=0;i=n[o];++o)i.isFile&&r.push([i.name,i.toURL?i.toURL():i.toURI()]);b.files=r,t&&t.apply(e,[r])},function(){t&&t.apply(e,[null])})},d=function(t,e,r){webkitRequestFileSystem(PERSISTENT,t,function(n){b.fs=n,b.quota=t,p(function(){b.initialized=!0,e.apply(r,[t,n])},r)},n)},g=function(t,e,r){return navigator.webkitPersistentStorage?void navigator.webkitPersistentStorage.requestQuota(t,function(t){d(t,e,r)},n):void e.apply(r,[0,null])},v=t("./xhr_read").read,m=t("./xhr_read").xhr_read,b={read:v,readdir:p,open:h,close:o,fstatSync:s,fstat:a,getFileSize:r,xhr_read:m,xhr_getFileSize:i};e.exports=b},{"./xhr_read":31}],25:[function(t,e){e.exports={open:t("./kdb")}},{"./kdb":26}],26:[function(t,e){var n=null;if("undefined"==typeof ksanagap)try{var r=t("react-native"),i=r.Platform.OS;n=t("android"==i?"./kdbfs_rn_android":"./kdbfs_ios")}catch(o){n=t("./kdbfs")}else n=t("ios"==ksanagap.platform?"./kdbfs_ios":"node-webkit"==ksanagap.platform?"./kdbfs":"chrome"==ksanagap.platform?"./kdbfs":"./kdbfs_android");var s={uint8:"1",int32:"4",utf8:"8",ucs2:"2",bool:"^",blob:"&",utf8arr:"*",ucs2arr:"@",uint8arr:"!",int32arr:"$",vint:"`",pint:"~",array:"",object:""},a=0,c=function(t,e){console.log(t,e,"bytes")};a&&(readLog=c);var u="￿",l=function(t,e,r){const i=function(t){const e=t.handle&&t.handle.url&&0==t.handle.url.indexOf("http://127.0.0.1"),n=t.handle&&t.handle.file;return!(!e&&!n)};var o=function(){if("undefined"!=typeof Window&&this===Window)throw"should add new before calling Create";"function"==typeof e&&(r=e,e={});var o=this;new n(t,e,function(t){return t?(setTimeout(function(){r(t,0)},0),null):(o.size=this.size,o.fs=this,o.local=i(this),o.fs&&(o.url=o.fs.handle.url),F.call(o),void 0)})},c=null,l={},f={},h=function(t,e,n,r){var i=this;this.fs.readBuf_packedint(t.cur,e,n,!0,function(e){t.cur+=e.adv,r.call(i,e.data,t.key)})},p=function(t,e){var n=this;h.apply(this,[t,6,1,function(r){e.call(n,r[0],t.key)}])},d=function(t,e,n,r){var i=this;this.fs.readBuf_packedint(t.cur,e,n,!1,function(e){t.cur+=e.adv,r.call(i,e.data,t.key)})},g=function(t,e){var n=this,r=0;this.fs.readUI8(t.cur,function(i){var o=4294967296*i;t.cur++,n.fs.readUI32(t.cur,function(i){t.cur+=4,r=t.cur,o+=i,t.cur+=o,p.apply(n,[t,function(i){h.apply(n,[t,6*i,i,function(t){e({count:i,sz:t,offset:r})}])}])})})},v=function(t,e,n){var r=this;g.apply(this,[t,function(e){var i=[],o=t.cur;if(t.cur=e.offset,t.lazy)for(var s=e.offset,a=0;a<e.sz.length;a++){var c=e.sz[a];i[i.length]=u+s.toString(16)+u+c.toString(16),s+=c}else{for(var l=[],a=0;a<e.count;a++)l.push(function(e){return function(n){"object"==typeof n&&n.__empty||i.push(n),t.blocksize=e,x.apply(r,[t,l.shift()])}}(e.sz[a]));l.push(function(e){i.push(e),t.cur=o,n.apply(r,[i])})}t.lazy?n.call(r,i,t.key):l.shift()({__empty:!0})}])},m=function(t,e,n){var r=this,i=t.cur;g.apply(this,[t,function(o){t.blocksize=e-t.cur+i,x.apply(r,[t,function(e){t.keys&&e.map(function(e){t.keys.push(e)});var i={},s=t.cur;if(t.cur=o.offset,t.lazy)for(var c=o.offset,l=0;l<o.sz.length;l++)i[e[l]]=u+c.toString(16)+u+o.sz[l].toString(16),c+=o.sz[l];else{for(var f=[],l=0;l<o.count;l++)f.push(function(e,n){return function(o){"object"==typeof o&&o.__empty||(i[n]=o),t.blocksize=e,a&&readLog("key",n),setTimeout(function(){x.apply(r,[t,f.shift()])},0)}}(o.sz[l],e[l-1]));f.push(function(o){i[e[e.length-1]]=o,t.cur=s,n.apply(r,[i,t.key])})}t.lazy?n.apply(r,[i],t.key):f.shift()({__empty:!0});

}])}])},b=function(t,e,n,r){var i=this;this.fs.readStringArray(t.cur,e,n,function(n){t.cur+=e,r.apply(i,[n],t.key)})},k=function(t,e,n,r){var i=this;p.apply(this,[t,function(e){i.fs.readFixedArray(t.cur,e,n,function(o){t.cur+=e*n,r.apply(i,[o],t.key)})}])},y=function(t){var e=this.fs.readBuf(this.cur,t);return this.cur+=t,e},T=function(t,e,n){var r=t.blocksize||this.fs.size;t.cur+=this.fs.signature_size;var i=r-this.fs.signature_size;if(e===s.int32)t.cur+=4,this.fs.readI32(t.cur-4,n);else if(e===s.uint8)t.cur++,this.fs.readUI8(t.cur-1,n);else if(e===s.utf8){var o=t.cur;t.cur+=i,this.fs.readString(o,i,"utf8",n)}else if(e===s.ucs2){var o=t.cur;t.cur+=i,this.fs.readString(o,i,"ucs2",n)}else e===s.bool?(t.cur++,this.fs.readUI8(t.cur-1,function(t){n(!!t)})):e===s.blob?y(i,n):e===s.vint?h.apply(this,[t,i,i,n]):e===s.pint?d.apply(this,[t,i,i,n]):e===s.utf8arr?b.apply(this,[t,i,"utf8",n]):e===s.ucs2arr?b.apply(this,[t,i,"ucs2",n]):e===s.uint8arr?k.apply(this,[t,i,1,n]):e===s.int32arr?k.apply(this,[t,i,4,n]):e===s.array?v.apply(this,[t,i,n]):e===s.object?m.apply(this,[t,i,n]):(console.error("unsupported type",e,t),n.apply(this,[null]))},x=function(t,e){t=t||{},t.cur=t.cur||0;var n=this;return this.fs.readSignature(t.cur,function(r){T.apply(n,[t,r,e])}),this},A=function(t){c?t.call(this):x.apply(this,[{cur:0,lazy:!0},function(e){c=e,t.call(this)}])},P=function(t,e){if(0==t.length)return!0;var n=t.pop(),r=this;E.apply(this,[t,!1,function(){if(!t.join(u))return!!l[n];var i=l[t.join(u)];t.push(n),i?e.apply(r,[i.indexOf(n)>-1]):e.apply(r,[!1])}])},w=function(t){if(!c)return void 0;for(var e=c,n=0;n<t.length;n++){if("object"!=typeof e)return null;var r=e[t[n]];if("undefined"==typeof r)return null;e=r}return e},E=function(t,e,n,r){"undefined"==typeof t&&(t=[]),"string"==typeof t&&(t=[t]),"function"==typeof e&&(r=n,n=e,e={}),e=e||{};var r=r||this,i=this;const o=w(t);return(null!==o&&"undefined"!=typeof o||"function"!=typeof n)&&("string"==typeof o&&o[0]!==u||"string"!=typeof o)?(!e.syncable&&n&&n.call(r,o),o):void A.apply(this,[function(){var o=c;if(0==t.length)return void(e.address?n.apply(r,[[0,i.fs.size]]):n.apply(r,[Object.keys(c)]));for(var s="",a=[],h={},p=null,d="",g=0;g<t.length;g++){var v=function(c,g){return function(v){if("object"==typeof v&&v.__empty?(v=o[c],p=v):("string"==typeof o[d]&&o[d][0]==u&&(o[d]={}),o[d]=v,o=o[d],p=v[c],l[s]=e.keys),"undefined"==typeof p)a=null,n.apply(r,[p]);else if(parseInt(g)&&(s+=u),s+=c,"string"==typeof p&&p[0]==u){var m=p.substring(1).split(u).map(function(t){return parseInt(t,16)}),b=m[0],k=m[1];h.lazy=!e.recursive||g<t.length-1,h.blocksize=k,h.cur=b,h.keys=[],h.key=c,d=c,e.address&&1==a.length?(f[s]=[b,k],a.shift()(null,f[s])):x.apply(i,[h,a.shift()])}else e.address&&1==a.length?a.shift()(null,f[s]):a.shift().call(i,p,c)}}(t[g],g);a.push(v)}0==a.length?n.apply(r,[o]):(a.push(function(i,a){if(e.address)n.apply(r,[a]);else{var c=t[t.length-1];o[c]=i,l[s]=e.keys,n&&n.apply(r,[i])}}),a.shift()({__empty:!0}))}])},O=function(t,e){t||(t=[]);var n=this;E.apply(this,[t,!1,function(){t&&t.length?e.apply(n,[l[t.join(u)]]):e.apply(n,[Object.keys(c)])}])},F=function(){this.load=x,this.cache=function(){return c},this.key=function(){return l},this.free=function(){c=null,l=null,this.fs.free()},this.setCache=function(t){c=t},this.keys=O,this.get=E,this.exists=P,this.DT=s;var t=this,e=0;r&&setTimeout(function(){r(e,t)},0)};return o.call(this)};l.datatypes=s,e&&(e.exports=l)},{"./kdbfs":27,"./kdbfs_android":28,"./kdbfs_ios":29,"./kdbfs_rn_android":30,"react-native":void 0}],27:[function(t,e){var n,r,i;const o=function(){n=t("./html5read"),r=function(){return""},i=!0};try{n=t("fs"),r=t("buffer").Buffer}catch(s){o()}"undefined"!=typeof window&&window.node_modules&&window.node_modules.fs?(n=window.node_modules.fs,r=window.node_modules.buffer.Buffer,console.log("fs by node webkit")):n.existsSync||o();var a=1,c=0,u=function(){},l=function(t,e){console.log(t,e)};c&&(u=l);var f=function(t,e,n){e=e||t.length;var r=[],i=0,o=0;do{var s=1;do o+=t[i]%128*s,s=128*s;while(t[++i]%256>=128);r.push(o),n&&(o=0),e--}while(i<t.length&&e);return{data:r,adv:i}},h=function(t,e,o){e=e||{};var s=this,c=function(){if(i){if(e.webStorage);else if(window){var r=window.location.href.lastIndexOf("/"),a=window.location.href.substr(0,r+1);0==window.location.protocol.indexOf("http")?"string"==typeof t&&"blob:"!==t.substr(0,5)&&(t.indexOf("/")>-1&&(a=window.location.origin+"/"),-1==t.indexOf("http")&&(t=a+t)):0==window.location.protocol.indexOf("chrome-extension:")&&(-1==t.indexOf("chrome-extension:"),t=a+t)}n.open(t,function(e){return e?(s.handle=e,s.html5fs=!0,l.call(s),s.opened=!0,void 0):void o("file not found:"+t)})}else{if(!n.existsSync||!n.existsSync(t))return o("file not found:"+t),null;this.handle=n.openSync(t,"r"),this.opened=!0,l.call(this)}return this},l=function(){var e=this;if(this.readSignature=h,this.readI32=y,this.readUI32=k,this.readUI8=T,this.readBuf=x,this.readBuf_packedint=A,this.readFixedArray=w,this.readString=g,this.readStringArray=b,this.signature_size=a,this.free=E,this.read=n.read,i){var r=t;this.handle.file?(this.size=this.handle.file.size,this.read=n.xhr_read,o.call(this)):this.handle.blobsize?(this.read=n.xhr_read,this.size=this.handle.blobsize,o.call(this)):n&&n.fs&&n.fs.root?(0==t.indexOf("filesystem:")&&(r=t.substr(t.lastIndexOf("/"))),n.fs.root.getFile(r,{},function(t){t.getMetadata(function(t){e.size=t.size,o&&setTimeout(function(){o.call(e)}.bind(e),0)})})):this.handle.url&&n.xhr_getFileSize(this.handle.url,function(t,r){t?o&&o.call(e,"cannot open file"):(e.size=r,e.read=n.xhr_read,e.handle.filesize=r,o&&setTimeout(o.bind(e),0))})}else{var s=n.fstatSync(this.handle);this.stat=s,this.size=s.size,o&&setTimeout(o.bind(this,0),0)}},h=function(t,e){var n=r.alloc?r.alloc(a):new r(a),o=this;this.read(this.handle,n,0,a,t,function(t,n,r){if(i)var s=String.fromCharCode(new Uint8Array(r)[0]);else var s=r.toString("utf8",0,a);u("signature",s.charCodeAt(0)),e.apply(o,[s])})},p=function(t){for(var e="",n=0,r=0,i=0,o=0,n=0;n<t.length&&!(t.charCodeAt(n)>127);n++);if(n>=t.length)return t;for(;n<t.length;)r=t.charCodeAt(n),128>r?(e+=t[n],n++):r>191&&224>r?(i=t.charCodeAt(n+1),e+=String.fromCharCode((31&r)<<6|63&i),n+=2):(i=t.charCodeAt(n+1),o=t.charCodeAt(n+2),e+=String.fromCharCode((15&r)<<12|(63&i)<<6|63&o),n+=3);return e},d=function(t){if("undefined"!=typeof TextDecoder){var e=new TextDecoder("utf-16le");return e.decode(t)}return String.fromCharCode.apply(null,new Uint16Array(t))},g=function(t,e,n,o){n=n||"utf8";var s=new r(e),a=this;this.read(this.handle,s,0,e,t,function(t,e,r){if(u("string",e),i){if("utf8"==n)var s=p(String.fromCharCode.apply(null,new Uint8Array(r)));else var s=d(r);o.apply(a,[s])}else o.apply(a,[r.toString(n)])})},m=function(t,e){if("undefined"!=typeof TextDecoder){"ucs2"===e&&(e="utf-16le");var n=new TextDecoder(e);return n.decode(t).split("\x00")}if("utf8"==e)var r=new Uint8Array(t);else var r=new Uint16Array(t);for(var i=0,o=[],s=[],a="";i<r.length;)r[i]?o[o.length]=r[i]:(a=String.fromCharCode.apply(null,o),s[s.length]="utf8"==e?p(a):a,o=[]),i++;return a=String.fromCharCode.apply(null,o),s[s.length]="utf8"==e?p(a):a,s},b=function(t,e,n,o){var s=this,a=null;if(0==e)return[];n=n||"utf8";var c=new r(e);this.read(this.handle,c,0,e,t,function(t,e,r){i?(u("stringArray",r.byteLength),a="utf8"==n?m(r,"utf8"):m(r,"ucs2")):(u("stringArray",r.length),a=r.toString(n).split("\x00")),o.apply(s,[a])})},k=function(t,e){var n=new r(4),o=this;this.read(this.handle,n,0,4,t,function(n,r,s){if(i){var a=new DataView(s).getUint32(0,!1);u("ui32",a+" at"+t),e(a)}else e.apply(o,[s.readInt32BE(0)])})},y=function(t,e){var n=new r(4),o=this;this.read(this.handle,n,0,4,t,function(t,n,r){if(i){var s=new DataView(r).getInt32(0,!1);u("i32",s),e(s)}else e.apply(o,[r.readInt32BE(0)])})},T=function(t,e){var n=new r(1),o=this;this.read(this.handle,n,0,1,t,function(t,n,r){if(i){var s=new Uint8Array(r)[0];u("ui8",s),e(s)}else e.apply(o,[r.readUInt8(0)])})},x=function(t,e,n){var i=this,o=new r(e);this.read(this.handle,o,0,e,t,function(r,o,s){u("buf pos "+t+" len "+o+" blocksize "+e);var a=new Uint8Array(s);n.apply(i,[a])})},A=function(t,e,n,r,i){var o=this;x.apply(this,[t,e,function(t){i.apply(o,[f(t,n,r)])}])},P=function(t,e,n,r){var i=null;if(1===n)i="getUint8";else if(2===n)i="getUint16";else{if(4!==n)throw"unsupported integer size";i="getUint32"}this.read(this.handle,null,0,n*e,t,function(t,e,o){u("fix array",e);var a=[];if(1==n)a=new Uint8Array(o);else for(var c=0;e/n>c;c++)a.push(v=new DataView(o)[i](c,!1));r.apply(s,[a])})},w=function(t,e,n,o){var s=null,a=this;if(n*e>this.size&&this.size)return void console.log("array size exceed file size",this.size);if(i)return P.apply(this,[t,e,n,o]);var c=new r(n*e);if(1===n)s=c.readUInt8;else if(2===n)s=c.readUInt16BE;else{if(4!==n)throw"unsupported integer size";s=c.readUInt32BE}this.read(this.handle,c,0,n*e,t,function(t,e){u("fix array",e);for(var r=[],i=0;i<c.length/n;i++)r.push(s.apply(c,[i*n]));o.apply(a,[r])})},E=function(){n.closeSync&&n.closeSync(this.handle)};return c()};e.exports=h},{"./html5read":24,buffer:void 0,fs:void 0}],28:[function(t,e){var n=0,r=function(t,e){n&&console.debug("read signature");var r=kfs.readUTF8String(this.handle,t,1);n&&console.debug(r,r.charCodeAt(0)),e.apply(this,[r])},i=function(t,e){n&&console.debug("read i32 at "+t);var r=kfs.readInt32(this.handle,t);n&&console.debug(r),e.apply(this,[r])},o=function(t,e){n&&console.debug("read ui32 at "+t);var r=kfs.readUInt32(this.handle,t);n&&console.debug(r),e.apply(this,[r])},s=function(t,e){n&&console.debug("read ui8 at "+t);var r=kfs.readUInt8(this.handle,t);n&&console.debug(r),e.apply(this,[r])},a=function(t,e,r){n&&console.debug("read buffer at "+t+" blocksize "+e);var i=kfs.readBuf(this.handle,t,e),o=JSON.parse(i);n&&console.debug("buffer length"+o.length),r.apply(this,[o])},c=function(t,e,r,i,o){n&&console.debug("read packed int at "+t+" blocksize "+e+" count "+r);var s=kfs.readBuf_packedint(this.handle,t,e,r,i),a=parseInt(s),c=JSON.parse(s.substr(s.indexOf("[")));n&&console.debug("packedInt length "+c.length+" first item="+c[0]),o.apply(this,[{data:c,adv:a}])},u=function(t,e,r,i){if(n&&console.debug("readstring at "+t+" blocksize "+e+" enc:"+r),"ucs2"==r)var o=kfs.readULE16String(this.handle,t,e);else var o=kfs.readUTF8String(this.handle,t,e);n&&console.debug(o),i.apply(this,[o])},l=function(t,e,r,i){n&&console.debug("read fixed array at "+t+" count "+e+" unitsize "+r);var o=kfs.readFixedArray(this.handle,t,e,r),s=JSON.parse(o);n&&console.debug("array length"+s.length),i.apply(this,[s])},f=function(t,e,r,i){n&&console.log("read String array at "+t+" blocksize "+e+" enc "+r),r=r||"utf8";var o=kfs.readStringArray(this.handle,t,e,r);n&&console.debug("read string array");var s=o.split("￿");n&&console.debug("array length"+s.length),i.apply(this,[s])},h=function(t,e){var n=kfs.mergePostings(this.handle,JSON.stringify(t));return e(n&&0!=n.length?JSON.parse(n):[])},p=function(){kfs.close(this.handle)},d=function(t,e,d){e=e||{};var g=1,v=function(){this.readSignature=r,this.readI32=i,this.readUI32=o,this.readUI8=s,this.readBuf=a,this.readBuf_packedint=c,this.readFixedArray=l,this.readString=u,this.readStringArray=f,this.signature_size=g,this.mergePostings=h,this.free=p,this.size=kfs.getFileSize(this.handle),n&&console.log("filesize  "+this.size),d&&d.call(this)};return this.handle=kfs.open(t),this.opened=!0,v.call(this),this};e.exports=d},{}],29:[function(require,module,exports){"use strict";var kfs=require("react-native").NativeModules.KsanaFileSystem,verbose=0,async=!!kfs.async,readSignature=function(t,e){if(verbose&&ksanagap.log("read signature at "+t),async){var n=this;kfs.readUTF8String(this.handle,t,1,function(t){e.call(n,t)})}else{var r=kfs.readUTF8String(this.handle,t,1);verbose&&ksanagap.log(r+" "+r.charCodeAt(0)),e.apply(this,[r])}},readI32=function(t,e){if(async){var n=this;kfs.readInt32(this.handle,t,function(t){e.call(n,t)})}else{verbose&&ksanagap.log("read i32 at "+t);var r=kfs.readInt32(this.handle,t);verbose&&ksanagap.log(r),e.apply(this,[r])}},readUI32=function(t,e){if(async){var n=this;kfs.readUInt32(this.handle,t,function(t){e.call(n,t)})}else{verbose&&ksanagap.log("read ui32 at "+t);var r=kfs.readUInt32(this.handle,t);verbose&&ksanagap.log(r),e.apply(this,[r])}},readUI8=function(t,e){if(async){var n=this;kfs.readUInt8(this.handle,t,function(t){e.call(n,t)})}else{verbose&&ksanagap.log("read ui8 at "+t);var r=kfs.readUInt8(this.handle,t);verbose&&ksanagap.log(r),e.apply(this,[r])}},readBuf=function(t,e,n){if(async){var r=this;kfs.readBuf(this.handle,t,e,function(t){n.call(r,t)})}else{verbose&&ksanagap.log("read buffer at "+t);var i=kfs.readBuf(this.handle,t,e);verbose&&ksanagap.log("buffer length"+i.length),n.apply(this,[i])}},readBuf_packedint=function(pos,blocksize,count,reset,cb){if(async){var that=this;kfs.readBuf_packedint(this.handle,pos,blocksize,count,reset,function(buf){"string"==typeof buf.data&&(buf.data=eval("["+buf.data.substr(0,buf.data.length-1)+"]")),cb.call(that,buf)})}else{verbose&&ksanagap.log("read packed int fast, blocksize "+blocksize+" at "+pos);var t=new Date,buf=kfs.readBuf_packedint(this.handle,pos,blocksize,count,reset);verbose&&ksanagap.log("return from packedint, time"+(new Date-t)),"string"==typeof buf.data&&(buf.data=eval("["+buf.data.substr(0,buf.data.length-1)+"]")),verbose&&ksanagap.log("unpacked length"+buf.data.length+" time"+(new Date-t)),cb.apply(this,[buf])}},readString=function(t,e,n,r){verbose&&ksanagap.log("readstring at "+t+" blocksize "+e+" "+n);var i=new Date;if("ucs2"==n){if(async){var o=this;return void kfs.readULE16String(this.handle,t,e,function(t){r.call(o,t)})}var s=kfs.readULE16String(this.handle,t,e)}else{if(async){var o=this;return void kfs.readUTF8String(this.handle,t,e,function(t){r.call(o,t)})}var s=kfs.readUTF8String(this.handle,t,e)}verbose&&ksanagap.log(s+" time"+(new Date-i)),r.apply(this,[s])},readFixedArray=function(t,e,n,r){if(async){var i=this;kfs.readFixedArray(this.handle,t,e,n,function(t){r.call(i,t)})}else{verbose&&ksanagap.log("read fixed array at "+t);var o=new Date,s=kfs.readFixedArray(this.handle,t,e,n);verbose&&ksanagap.log("array length "+s.length+" time"+(new Date-o)),r.apply(this,[s])}},readStringArray=function(t,e,n,r){if(n=n||"utf8",async){var i=this;kfs.readStringArray(this.handle,t,e,n,function(t){"string"==typeof t&&(t=t.split("\x00")),r.call(i,t)})}else{verbose&&ksanagap.log("read string array at "+t);var o=new Date,s=kfs.readStringArray(this.handle,t,e,n);"string"==typeof s&&(s=s.split("\x00")),verbose&&ksanagap.log("string array length"+s.length+" time"+(new Date-o)),r.apply(this,[s])}},mergePostings=function(positions,cb){if(kfs.async)kfs.mergePostings(this.handle,positions,function(buf){"string"==typeof buf&&(buf=eval("["+buf.substr(0,buf.length-1)+"]")),cb(buf)});else{var buf=kfs.mergePostings(this.handle,positions,cb);"string"==typeof buf&&(buf=eval("["+buf.substr(0,buf.length-1)+"]")),cb(buf)}},free=function(){kfs.close(this.handle,function(){})},Open=function(t,e,n){e=e||{};var r=1,i=function(){if(this.readSignature=readSignature,this.readI32=readI32,this.readUI32=readUI32,this.readUI8=readUI8,this.readBuf=readBuf,this.readBuf_packedint=readBuf_packedint,this.readFixedArray=readFixedArray,this.readString=readString,this.readStringArray=readStringArray,this.signature_size=r,this.mergePostings=mergePostings,this.free=free,1==kfs.getFileSize.length)this.size=kfs.getFileSize(this.handle),n&&n.call(this);else{var t=this;kfs.getFileSize(this.handle,function(e){t.size=e,n&&n.call(t)})}};if(1==kfs.open.length)return this.handle=kfs.open(t),this.opened=!0,i.call(this),this;var o=this;this.async=!0,kfs.open(t,function(e){return e?(o.opened=!0,o.handle=e,void i.call(o)):void n.call(null,"File not file:"+t)})};module.exports=Open},{"react-native":void 0}],30:[function(t,e){var n=t("react-native").NativeModules.KsanaFileSystem,r=0,i=function(t,e){r&&console.debug("read signature"),n.readUTF8String(this.handle,t,1,function(t){r&&console.debug(t,t.charCodeAt(0)),e.apply(this,[t])})},o=function(t,e){r&&console.debug("read i32 at "+t),n.readInt32(this.handle,t,function(t){r&&console.debug(t),e.apply(this,[t])})},s=function(t,e){r&&console.debug("read ui32 at "+t),n.readUInt32(this.handle,t,function(t){r&&console.debug(t),e.apply(this,[t])})},a=function(t,e){r&&console.debug("read ui8 at "+t),n.readUInt8(this.handle,t,function(t){r&&console.debug(t),e.apply(this,[t])})},c=function(t,e,i){r&&console.debug("read buffer at "+t+" blocksize "+e),n.readBuf(this.handle,t,e,function(t){r&&console.debug("buffer length"+t.length),i.apply(this,[t])})},u=function(t,e,i,o,s){r&&console.debug("read packed int at "+t+" blocksize "+e+" count "+i),n.readBuf_packedint(this.handle,t,e,i,o,function(t){var e=parseInt(t),n=JSON.parse(t.substr(t.indexOf("[")));r&&console.debug("packedInt length "+n.length+" first item="+n[0]),s.apply(this,[{data:n,adv:e}])})},l=function(t,e,i,o){if(r&&console.debug("readstring at "+t+" blocksize "+e+" enc:"+i),"ucs2"==i)var s=n.readULE16String;else var s=n.readUTF8String;s(this.handle,t,e,function(t){r&&console.debug(t),o.apply(this,[t])})},f=function(t,e,i,o){r&&console.debug("read fixed array at "+t+" count "+e+" unitsize "+i),n.readFixedArray(this.handle,t,e,i,function(t){var e=JSON.parse(t);r&&console.debug("array length"+e.length),o.apply(this,[e])})},h=function(t,e,i,o){r&&console.log("read String array at "+t+" blocksize "+e+" enc "+i),i=i||"utf8",n.readStringArray(this.handle,t,e,i,function(t){r&&console.debug("read string array");var e=t.split("￿");r&&console.debug("array length"+e.length),o.apply(this,[e])})},p=function(t,e){n.mergePostings(this.handle,JSON.stringify(t),function(t){return e(t&&0!=t.length?JSON.parse(t):[])})},d=function(){n.close(this.handle,function(){})},g=function(t,e,g){e=e||{};var v=1,m=function(){this.readSignature=i,this.readI32=o,this.readUI32=s,this.readUI8=a,this.readBuf=c,this.readBuf_packedint=u,this.readFixedArray=f,this.readString=l,this.readStringArray=h,this.signature_size=v,this.mergePostings=p,this.free=d,n.getFileSize(this.handle,function(t){this.size=t}.bind(this)),r&&console.log("filesize  "+this.size),g&&g.call(this)};return n.open(t,function(e){return e?(this.handle=e,this.opened=!0,void m.call(this)):void g.call(null,"File not found:"+t)}.bind(this)),this};e.exports=g},{"react-native":void 0}],31:[function(t,e){var n={},r=65536,i=function(t,e,n){for(var r=e;n>=r;r++)if(!t[r])return!1;return!0},o=function(t,e,n){var i=Math.floor(e/r),o=Math.floor((e+n)/r);if(i===o){var s=e+n-i*r;return s>=t[i].byteLength&&(s=t[i].byteLength),t[i].slice(e-i*r,s)}for(var a=new Uint8Array(n),c=0,u=i;o>=u;u++){var l;if(u==i)l=new Uint8Array(t[i].slice(e-i*r,t[i].byteLength)),a.set(l,0),c=t[i].byteLength-(e-i*r);else if(u==o){var s=e+n-o*r;s>=t[o].byteLength&&(s=t[o].byteLength),l=new Uint8Array(t[o].slice(0,s)),a.set(l,c)}else l=new Uint8Array(t[u]),a.set(l,c),c+=t[u].byteLength}return a.buffer},s=function(t,e,s,c,u,l){n[t.url]||(n[t.url]=[]);var f=n[t.url],h=Math.floor(u/r),p=Math.floor((u+c)/r);if(i(f,h,p)){var d=o(f,u,c);return void l(0,d.byteLength,d)}a(t,null,0,(p-h+1)*r,h*r,function(t,e,n){for(var i=0;p-h>=i;i++){var s=(i+1)*r;s>=n.byteLength&&(s=n.byteLength),f[i+h]=n.slice(i*r,s)}var a=o(f,u,c);l(0,a.byteLength,a)})},a=function(t,e,n,r,i,o){var s=new XMLHttpRequest,a=t.url;-1==a.indexOf("blob:")&&(a+="?"+(new Date).getTime()),s.open("GET",a,!0);var c=[i,r+i-1];c[1]+1>t.filesize&&(c[1]=t.filesize-1),s.setRequestHeader("Range","bytes="+c[0]+"-"+c[1]),s.responseType="arraybuffer",s.onload=function(){var t=this;setTimeout(function(){o(0,t.response.byteLength,t.response)},0)},s.send()};e.exports={read:a,xhr_read:s}},{}],32:[function(t,e){const n=t("ksana-corpus/bsearch"),r=50,i=1.1,o=50,s=1.5,a=t("./utils").postingToKPos,c=function(t,e,r,i){var o=[],s={};return r.forEach(function(i,a){const c=n(t,i);if(c>-1&&(s[i]||(o.push([c,e[c],i]),s[i]=!0)),a){const u=r[a-1]+i,l=n(t,u);l>-1&&t[l]==u&&(s[u]||(o.push([l,e[l],u]),s[u]=!0))}}),o=o.filter(function(t){return-1!==t[0]}),o.length>i&&(o.length=i),o},u=function(t){var e=[].concat.apply([],t);return e.sort(function(t,e){return t-e})},l=function(t,e,n,r){for(var i=[],o=(new Date,0);o<t.length;o++){for(var s=1,a=0;e>s&&t[o+s]-t[o]<e;)a++,s++;a>=n&&i.push([t[o],a])}return i.sort(function(t,e){return e[1]-t[1]}),i.length>r&&(i.length=r),i},f=function(t,e,r,o){for(var s=0;s<t.length;s++){var a=0,c=0;const u=t[s][0]+e,l=Math.pow(i,r.length)+o.reduce(function(t,e){return t+e},0);for(var f=0;f<r.length;f++){const h=r[f],p=n(h,u,!0);u-h[p-1]<=e&&(a++,c+=o[f])}var d=(Math.pow(i,a)+c)/l;t[s][1]=d}return t},h=function(t){const e=Math.max.apply(null,t.map(function(t){return t[1]}));return t.map(function(t){return[t[0],Math.sqrt(Math.sqrt(t[1]/e))]})},p=function(t,e){new Date;const n=t.reduce(function(t,e){return t+e.length},0),i=n/t.length,o=u(t);if(e=e||{},!e.postingweight){e.postingweight=[];for(var s=0;s<t.length;s++)e.postingweight[s]=Math.log(2+Math.log(2+i/t[s].length))}const a=e.maxcandidate||r,c=e.windowsize||t.length,p=e.threshold||t.length/2;var d=l(o,c,p,a);return d=t.length>1?f(d,c,t,e.postingweight):h(d),d.sort(function(t,e){return e[1]-t[1]}),d},d=function(t,e,n,r){const i=t.tokenizer.tokenize(e),u=i.map(function(t){return t[0]});var l={},f=new Date,h=f;const d=n.maxtoken||o;t.get([["inverted","tokens"],["inverted","posting_length"]],function(e){const i=e[0],o=e[1];var g=c(i,o,u,d);const v=g.reduce(function(t,e){return t+e[1]},0),m=v/g.length,b=Math.floor(g.length/2),k=Math.floor(u.length*(n.windowsize||s));g.sort(function(t,e){return e[1]-t[1]});for(var y=0;y<g.length&&!(g[0][1]<2*m);y++)g.shift();const T=g.map(function(t){return["inverted","postings",t[0]]}),x=g.map(function(t){return t[2]}).join(" ");t.get(T,function(e){l.loadposting=new Date-h,h=new Date;var i={maxcandidate:n.maxcandidate,timer:l,windowsize:k,threshold:b};const o=p(e,i);l.reduceposting=new Date-f;const s=e.map(function(t,e){return{postings:t,lengths:x[e].length,phrase:x[e]}});n.kpos?(h=new Date,a(t,o,function(t){l.tokpos=new Date-h,r&&r({matches:t,phrasepostings:s,terms:x,timer:l,unit:"kpos"})})):r&&r({matches:o,terms:x,phrasepostings:s,timer:l})})})};e.exports={convolutionSearch:d,reducePostings:p,postingToKPos:a}},{"./utils":40,"ksana-corpus/bsearch":42}],33:[function(t,e){const n=t("./plist"),r=(t("ksana-corpus").bsearch,function(t,e,r){t.fromTPos(e.tpos,{line:e.line||1},function(i){if(!i)return void(r&&r(null));const o=i.linekrange,s=(i.kpos,i.linetpos);t.getText(o,function(i){for(var a=[],c=0;c<i.length;c++){var u=[];const l=t.parseRange(o[c]).start,f=t.layoutText(i[c],l,null,s[c]);e.phrasepostings&&e.phrasepostings.forEach(function(e){const r=s[c][s[c].length-1],i=n.trim(e.postings,s[c][0],r),o=t.fromTPos(i,{linetext:f.lines,linetpos:f.linetpos}).kpos,a=i.map(function(t,n){return t+(e.lengths[n]||e.lengths)}),l=t.fromTPos(a,{linetext:f.lines,linetpos:f.linetpos}).kpos;u.push({phrase:e.phrase,hits:o,hitsend:l,lengths:e.lengths})}),a.push({rawtext:i[c],text:f.lines.join("\n"),linebreaks:f.linebreaks,linetpos:f.linetpos,phrasehits:u})}r(a)})})});e.exports={fetchExcerpts:r}},{"./plist":38,"ksana-corpus":50}],34:[function(t,e){const n=t("ksana-corpus").bsearch,r=t("./plist"),i=function(t,e){return r.groupStat(t,e)},o=function(t,e,r){if(!t)return[];if(!r)return e;for(var i=e.slice(),o=0;o<r.length;o++)if(r[o]){const s=t.groupTRange(o),a=n(i,s[0],!0),c=n(i,s[1],!0);i.splice(a,c-a)}return i};e.exports={groupStat:i,filterMatch:o}},{"./plist":38,"ksana-corpus":50}],35:[function(t,e){const n=t("./plist"),r=t("ksana-corpus/bsearch"),i=function(t,e){for(var r=[],i=0;i<t.length;i++)postings=t[i].postings,postings&&(r=r.concat(n.trim(postings,e.tstart,e.tend)));return r},o=function(t,e){const o=t.searchresult;if(!o||!o.phrasepostings)return void e([]);const s=t.cor,a=t.linebreaks,c=(t.pagebreaks,t.lines),u=t.article;var l=[];if(!o.phrasepostings)return void e(null);const f=i(o.phrasepostings,u);s.fromTPos(f,{},function(t){return t&&t.kpos?(o.phrasepostings.forEach(function(t,e){if(t.postings){const i=n.trim(t.postings,u.tstart,u.tend),o=s.fromTPos(i,{});for(var f,h=[],p=0;p<o.kpos.length;p++){var d=r(a,o.kpos[p]);-1==d&&(d=a.length-1),0==p&&(f=a[d]),h.push(c[d])}const g=s.fromTPos(i,{linetext:h,linetpos:o.linetpos}).kpos,v=i.map(function(e){return e+(t.lengths[p]||t.lengths)}),m=s.fromTPos(v,{linetext:h,linetpos:o.linetpos}).kpos;l.push({phrase:t.phrase,hits:g,hitsend:m,lengths:t.lengths,idx:e})}}),void e(l)):void e(null)})};e.exports={getArticleHits:o}},{"./plist":38,"ksana-corpus/bsearch":42}],36:[function(t,e){const n=(t("ksana-corpus").bsearch,t("./convolution").convolutionSearch),r=t("./strstr").indexOf,i=(t("./convolution").reducePostings,t("./utils").postingToKPos,t("./hits").getArticleHits),o=t("./phrasesearch"),s=t("./plist"),a=t("./excerpt"),c=t("./grouping"),u=function(t){const e=t.split(/(".+?")/g);for(var n=[],r=0;r<e.length;r++){var i=e[r];'"'==i[0]?n.push(i.substr(1,i.length-2)):n=n.concat(i.split(/([ !]+)/g))}return n=n.filter(function(t){return t.trim().length})},l=function(t,e){var n=u(e);return n},f=function(t,e){const n=t.tokenizer.TokenTypes,r=t.tokenizer.tokenize(e),i=n.PUNC,s=r.filter(function(t){return t[3]==i}).length;return s||r.length>=15?o.fuzzyPhrase:o.simplePhrase},h=function(t,e,n,r){"function"==typeof n&&(r=n);const i=l(t,e);for(var o=[],a=[],c=[],u=new Date,h=u,p={},d=0;d<i.length;d++){const g=f(t,i[d]);a.push(function(e,n){return function(r){"object"==typeof r&&r.__empty||c.push(r),e(t,n,a.shift())}}(g,i[d]))}a.push(function(t){if(p.postings=new Date-h,h=new Date,t.__empty)return void r({matches:[],count:0,phrasepostings:[],timer:{}});if(t.fuzzy)return void r(t);c.push(t);if(c.length>1){const e=c.map(function(t){return t.postings});o=s.plmerge(e,100),count=o.length}else c.length&&c[0].postings?(count=c[0].postings.length,o=c[0].postings):count=0;p.reduce=new Date-h,h=new Date,r({matches:o,count:count,phrasepostings:c,timer:p})}),a.shift()({__empty:!0})};e.exports={search:h,convolutionSearch:n,breakIntoPhrases:u,excerpt:a,strstr:r,groupStat:c.groupStat,filterMatch:c.filterMatch,getArticleHits:i}},{"./convolution":32,"./excerpt":33,"./grouping":34,"./hits":35,"./phrasesearch":37,"./plist":38,"./strstr":39,"./utils":40,"ksana-corpus":50}],37:[function(t,e){const n=t("./convolution").convolutionSearch,r=t("./plist"),i=function(t,e,n){var r=t.expandVariant(e),i=t.expandVariant(n),o=[];r==e&&(r=[e]),i==n&&(i=[n]);for(var s=0;s<r.length;s++)for(var a=0;a<i.length;a++)o.push(r[s]+i[a]);return o};var o=function(t,e){var n=t.get(["inverted","tokens"])||[],o=t.tokenizer.tokenize(e);o=o.filter(function(t){return"P"!==t[3]&&" "!==t[3]});for(var s=[],a=[],c=0,u=-1,l=function(e){var i=t.expandVariant(e);i instanceof Array&&(i=i.filter(function(t){const e=r.indexOfSorted(n,t);return e>-1&&n[e]==t}),1==i.length&&(i=i[0])),s.push(i),a.push(1)};c+1<o.length;){var f=o[c][0],h=o[c+1][0];const p=i(t,f,h),d=[];for(var g=0;g<p.length;g++){var v=r.indexOfSorted(n,p[g]);n[v]===p[g]&&d.push(p[g])}d.length?(s.push(1==d.length?d[0]:d),c+3<o.length?(u=c,c+=2):(c+2==o.length?(u+1==c&&a[a.length-1]--,u=c,c++):u=c,c++),a.push(2)):(2==a[a.length-1]&&(f=o[c+1][0]),l(f),c++)}for(var m=a.reduce(function(t,e){return t+e},0);m<o.length;)f=o[c][0],l(f),c++,m++;return{tokens:s,lengths:a,tokenlength:o.length}};var s=function(t,e){"string"==typeof e&&(e=[e]);const n=t.get(["inverted","tokens"]);for(var i=[],o=0;o<e.length;o++){const s=r.indexOfSorted(n,e[o]);s>-1&&n[s]==e[o]&&i.push(s)}return i.map(function(t){return["inverted","postings",t]})};const a=function(t,e,n){var i=[];const o=[];for(var a=0;a<e.length;a++){const c=e[a],u=s(t,c);if(1==u.length)o.push([c,1]),i.push(u[0]);else{const l=t.cachedPostings[c];l?o.push([c,l]):(o.push([c,u.length]),i=i.concat(u))}}t.get(i,function(e){for(var i=0,s=0;s<e.length;){const a=o[i][1];if(a instanceof Array)s++;else{if(1==a)o[i][1]=e[s],s++;else{const c=[];for(var u=0;a>u;u++)c.push(e[s]),s++;const l=r.combine(c),f=o[i][0];t.cachedPostings[f.join(",")]=l,o[i][1]=l}i++}}const h=o.map(function(t){return t[0]}),p=o.map(function(t){return t[1]});n(h,p)})},c=function(t,e,n){const i=o(t,e.trim());if(t.mergePostings){var c=s(t,i.tokens);return void nativeMergePosting(t,c,n)}a(t,i.tokens,function(o,s){for(var a=s[0],c=i.lengths[0],u=1;u<s.length;u++){var l=s[u];a=r.pland(a,l,c),c+=i.lengths[u]}t.cachedPostings[e]=a,n({phrase:e,postings:a,lengths:i.tokenlength})})},u=function(t,e,r){e=e.replace(/[　 ]/g,""),n(t,e,{},function(t){const n=t.matches.map(function(t){return t[0]}),i=t.matches.map(function(t){return t[1]});r({scores:i,matches:n,phrasepostings:t.phrasepostings,count:t.matches.length,phrase:e,lengths:0,fuzzy:!0})})};e.exports={simplePhrase:c,fuzzyPhrase:u}},{"./convolution":32,"./plist":38}],38:[function(t,e){var n=function(t){var e=[],n=0,r=0;do{var i=0;do r+=(127&t[n])<<i,i+=7;while(128&t[++n]);e[e.length]=r}while(n<t.length);return e},r=function(t,e){if(t.length!=e.length+1)return null;for(var n=[],r=new Array(e.length),i=0;i<e.length;i++)r[i]=0;for(var i=1;i<t.length;i++){if(n.length>e[i-1])for(;n.length>e[i-1];)n.pop();n.push(i-1);for(var o=0;o<n.length;o++)r[n[o]]+=t[i]}return r},i=function(t,e){if(!e.length)return[t.length];for(var n=[],r=0;r<e.length;r++)n[r]=0;n[e.length]=0;for(var i=0,r=0;r<t.length&&i<e.length;){if(t[r]<=e[i])for(;i<e.length&&r<t.length&&t[r]<=e[i];)n[i]++,r++;i++}return n[e.length]=t.length-r,n},o=function(t,e){if(!e.length)return[t.length];for(var n=[],r=0;r<=e.length;r++)n[r]=[];for(var i=0,r=0;r<t.length&&i<e.length;){if(t[r]<e[i])for(;i<e.length&&r<t.length&&t[r]<e[i];){var o=0;i>0&&(o=e[i-1]),n[i].push(t[r++]-o)}i++}for(;r<t.length;)n[n.length-1].push(t[r++]-e[e.length-1]);return n},s=function(t,e){if(!t||!t.length)return[];if(!e||!e.length)return[t.length];for(var n=[],r=0;r<=e.length;r++)n[r]=[];for(var i=0,r=0;r<t.length&&i<e.length;){if(t[r]<e[i])for(;i<e.length&&r<t.length&&t[r]<e[i];){var o=0;i>0&&(o=e[i-1]),n[i].push(t[r++])}i++}for(;r<t.length;)n[n.length-1].push(t[r++]);return n},a=function(t,e,n,r){if(!t.length)return[{},{}];n=n||16;var i=Math.pow(2,n),o=0,s={},a={},c=0;do{var u=Math.floor(t[o]/i);s[u]||(s[u]=[],a[u]=[],c++),s[u].push(t[o]%i),a[u].push(e[o]),o++}while(o<t.length);return r&&(r.groupcount=c),[s,a]},c=function(t,e,n){if(!t.length)return{};e=e||16;var r=Math.pow(2,e),i=0,o={},s=0;do{var a=Math.floor(t[i]/r);o[a]||(o[a]=[],s++),o[a].push(t[i]%r),i++}while(i<t.length);return n&&(n.groupcount=s),o},u=function(t,e){for(var n=0,r=t.length-1;r>n;){var i=n+r>>1;t[i]<e?n=i+1:r=i}return n},l=function(t,e,n){n=n||{},n.max=n.max||1;var r=[];if(e.length<t.length)for(var i=0;i<e.length&&(k=u(t,e[i]),!(k>-1&&k<t.length&&t[k]==e[i]&&(r[r.length]=e[i],r.length>=n.max)));i++);else for(var i=0;i<t.length&&(k=u(e,t[i]),!(k>-1&&k<e.length&&e[k]==t[i]&&(r[r.length]=e[k],r.length>=n.max)));i++);return r},f=function(t,e,n,r){for(var i=[],o=0;o<t.length;){var s=u(e,t[o]+n),a=e[s]>=t[o]+n&&e[s]<=t[o]+r?s:-1;if(a>-1)i[i.length]=t[o],o++;else{if(s>=e.length)break;var c=u(t,e[s]-r);if(!(c>o))break;var a=e[s]>=t[o]+n&&e[s]<=t[o]+r?s:-1;a>-1&&(i[i.length]=t[c]),o=c}}return i},h=function(t,e,n,r){for(var i=[],o=0;o<t.length;){var s=u(e,t[o]+n),a=e[s]>=t[o]+n&&e[s]<=t[o]+r?s:-1;if(a>-1)o++;else{if(s>=e.length){i=i.concat(t.slice(o));break}var c=u(t,e[s]-r);if(!(c>o))break;i=i.concat(t.slice(o,c)),o=c}}return i},p=function(t,e,n){for(var r=[],i=0;i<t.length;){var o=u(e,t[i]+n),s=e[o]===t[i]+n?o:-1;if(s>-1)r.push(t[i]),i++;else{if(o>=e.length)break;var a=u(t,e[o]-n);if(!(a>i))break;s=e[o]===t[a]+n?o:-1,s>-1&&(r.push(t[a]),a++),i=a}}return r},d=function(t,e,n){for(var r=[],r=[],i=0;i<t.length;){var o=u(e,t[i]+n),s=e[o]===t[i]+n?o:-1;if(s>-1)i++;else{if(o>=e.length){r=r.concat(t.slice(i));break}var a=u(t,e[o]-n);if(!(a>i))break;r=r.concat(t.slice(i,a)),i=a}}return r},g=function(t,e,n){var r=[],i=0;if(t.length>e.length){var o=e;e=t,t=o,i=n,n=-n}for(var s=0;s<t.length;s++){var a=u(e,t[s]+n),o=e[a]===t[s]+n?a:-1;

o>-1&&r.push(t[s]-i)}return r},v=function(t){var e=[];for(var n in t)e=e.concat(t[n]);return e.sort(function(t,e){return t-e}),e},m=function(t){if(!t||!t.length)return[];for(var e={},n=[],r=0,i=t.length;i>r;++r)e.hasOwnProperty(t[r])||(n.push(t[r]),e[t[r]]=1);return n},b=function(t,e){var n=[];e=e||[];for(var r=0;r<t.length;r++){if(!t[r])return[];n=0===r?t[0]:"andnot"==e[r]?d(n,t[r],r):g(n,t[r],r)}return n},y=function(t,e,n,r){n=n||0,r=r||-1,-1==r&&(r=Math.pow(2,53));var i=0,o=j=0,s=0,a=[],c=[];if(!t)return{docs:[],freq:[]};for(;o<t.length&&j<e.length;)t[o]<e[j]?(i++,s=t[o],o++):(i&&s>=n&&r>s&&(a.push(j),c.push(i)),j++,i=0);if(i&&j<e.length&&s>=n&&r>s)a.push(j),c.push(i),i=0;else{for(;j==e.length&&o<t.length&&t[o]>=e[e.length-1];)o++,i++;s>=n&&r>s&&(a.push(j),c.push(i))}return{docs:a,freq:c}};const T=function(t,e){if(!t||!t.length)return[];if(t.length<2)return t[0];t.sort(function(t,e){return t.length-e.length});for(var n=t[0],r=1;r<t.length;)n=f(n,t[r],1,e),r++;return n};var x=function(t,e,n){var r=u(t,e),i=u(t,n);return e<t[i]&&n>t[i]&&i++,t.slice(r,i)};const A=function(t,e){if(!e.length)return[t.length];for(var n=[],r=0;r<=e.length;r++)n[r]=0;for(var i=0,r=0;r<t.length&&i<e.length;){if(t[r]<e[i])for(;i<e.length&&r<t.length&&t[r]<e[i];){var o=0;i>0&&(o=e[i-1]),n[i]++,r++}i++}for(;r<t.length;)n[n.length-1]++,r++;return n};var P={};P.unpack=n,P.plphrase=b,P.pland=g,P.plhead=l,P.plfollow2=f,P.plnotfollow2=h,P.plfollow=p,P.plnotfollow=d,P.unique=m,P.indexOfSorted=u,P.matchPosting=y,P.trim=x,P.groupbyslot=c,P.groupbyblock2=a,P.countbyposting=i,P.groupbyposting=o,P.groupbyposting2=s,P.groupStat=A,P.groupsum=r,P.combine=v,P.plmerge=T,e.exports=P},{}],39:[function(t,e){const n=1.3,r=function(t,e,n,r,i){for(var o=0,s=[],a=0;r>a;a++){var c=t[a];i&&(c=c[0]),e[c]&&o++}for(var a=r;a<t.length;a++){var u=t[a],l=t[a-r];if(i&&(u=u[0],l=l[0]),e[u]&&o++,a-r>=0&&e[l]&&o--,!(n>o)){var f=a-r;0>f&&(f=0);const h=s[s.length-1];h&&f-h[0]<r?o>h[1]&&(s[s.length-1][0]=f,s[s.length-1][1]=o):s.push([f,o])}}if(!s.length)return s;s.sort(function(t,e){return e[1]-t[1]});const p=s[0][1];for(var a=1;a<s.length&&!(p>1.1*s[a][1]);a++);return s.slice(0,a)},i=function(t,e,n,r){const i=[];for(var o=0;o<t.length;o++){const s=t[o];for(var a=s[0]-1,c=s[0]+r+1;!n[e[a][0]]&&a;)a++;for(;!n[e[c][0]]&&c;)c--;i.push([e[a][2],e[c][2]+1,s[1]])}return i},o=function(t,e,n,r){const i=[];for(var o=0;o<t.length;o++){const s=t[o];for(var a=s[0]-1,c=s[0]+r+1;!n[e[a]]&&a;)a++;for(;!n[e[c]]&&c;)c--;i.push([a,c+1,s[1]])}return i},s=function(t,e,n){for(var r=0;r<t.length;r++){const i=t[r],o=i[0],s=i[1],a=e.substring(o,s);var c=0;for(var u in n){const l=u.charCodeAt(0);13312>l||l>40959||-1===a.indexOf(u)&&c--}c&&(t[r][2]+=c)}return t.sort(function(t,e){return e[2]-t[2]})},a=function(t,e,a){a=a||{};const c={};var u,l;a.tokenizer?(l=a.tokenizer.tokenize(t),u=a.tokenizer.tokenize(e)):(l=t,u=e.split(""));const f=a.win_expand||n;u.forEach(function(t){c[t[0]]=!0});const h=Math.floor(u.length*f)+1,p=Math.floor(u.length/2);var d=r(l,c,p,h,a.tokenizer);const g=a.tokenizer?i:o;var v=g(d,l,c,h);return v=s(v,t,c,a.tokenizer)};e.exports={indexOf:a}},{}],40:[function(t,e){const n=function(t,e,n){var r={},i=[],o=t.map(function(t,n){return[e[n],t[1]]});o.forEach(function(t){const e=t[0];r[e]||(r[e]=0),t[1]>r[e]&&(r[e]=t[1])});for(var s in r)i.push([parseInt(s,10),r[s]]);return n||i.sort(function(t,e){return e[1]-t[1]}),i},r=function(t,e,r){var i=e,o=e,s=!1;"number"!=typeof o[0]?o=e.map(function(t){return t[0]}):(i=e.map(function(t){return[t,1]}),s=!0),t.fromTPos(o,function(t){const e=n(i,t,s);r(e)})};e.exports={postingToKPos:r}},{}],41:[function(t,e){const n=t("./ksanapos"),r=t("./bsearch"),i=function(t){const e=this.get(["inverted","article2tpos"]);var n=0,r=0;return e&&t>=0&&t<=e.length&&(n=e[t],r=e[t+1],n&&!r&&(r=this.meta.endtpos)),{start:n,end:r}},o=function(t){var e=t;const o=this.addressPattern;"string"==typeof t&&(e=n.parse(t,o));const s=n.breakRange(e,o),c=this.get(["gfields","article","pos"]),u=this.get(["gfields","article","value"]);if(!c)return null;var l=r(c,s.start+1,!0),f=c[l-1];f||(l=1,f=c[0]);var h=c[l];const p=a.call(this,f,h),d=i.call(this,l-1);return{at:l-1,articlename:u[l-1],tstart:d.start,tend:d.end,start:p.start,startH:this.stringify(p.start),end:p.end,endH:this.stringify(p.end)}},s=function(t){const e=this.get(["gfields","article","value"]);return e[t]},a=function(t,e){const r=this.addressPattern;if("undefined"==typeof e&&(e=this.meta.endpos),this.bookOf(e)>this.bookOf(t)){const i=n.makeKPos([this.bookOf(e),0,0,0],r);i==e?e=n.makeKPos([this.bookOf(t),r.maxpage-1,r.maxline-1,0],r):t=i}return{start:t,end:e}},c=function(t,e){const n=this.get(["gfields","article","pos"]),r=this.get(["gfields","article","value"]);if(!n)return null;if("string"==typeof id_name&&(t=r.indexOf(id_name)),0>t)return null;t+=e||0;var o=n[t],s=n[t+1];if(!o)return null;"undefined"==typeof s&&(s=this.meta.endpos);const c=a.call(this,o,s),u=i.call(this,t);return{at:t,articlename:r[t],end:c.end,start:c.start,tstart:u.start,tend:u.end,startH:this.stringify(c.start),end:c.end,endH:this.stringify(c.end)}},u=function(){const t=this.get(["gfields","article","value"]);return t.length},l=function(t,e){const n=r(t.pos,e.start,!0),i=r(t.pos,e.end,!0);return{pos:t.pos.slice(n,i+1),value:t.value.slice(n,i+1)}};e.exports={getArticle:c,articleOf:o,articleCount:u,getArticleName:s,adjustArticleRange:a,trimArticleField:l}},{"./bsearch":42,"./ksanapos":52}],42:[function(t,e){"use strict";var n=function(t,e,n){for(var r,i=0,o=t.length;o>i;){if(r=i+o>>1,t[r]===e)return r;t[r]<e?i=r+1:o=r}return n?i:t[i]===e?i:-1},r=function(t,e,n){for(var r=0,i=t.length;i>r;){var o=r+i>>1;if(t[o]===e)return o;t[o]<e?r=o+1:i=o}return n?r:t[r]===e?r:-1},i=function(t,e,i){var o=n;return"string"==typeof t[0]&&(o=r),o(t,e,i)};e.exports=i},{}],43:[function(e,n){const r=e("./bsearch"),i=e("./textutil"),o=function(t,e,n,r){for(var i=this.bookLineOf(e)-this.bookLineOf(n),o=0,s=this.bookLineOf(n)-t;i;){const a=r(s);if(!a)break;s++,o+=a.length,i--}return o},s=function(t,e,n,s){if("string"==typeof e){const a=i.parseRange.call(this,e);e=a.start}const c=r(t,e+1,!0)-1,u=t[c],l=this.charOf(u),f=this.bookLineOf(t[0]),h=o.call(this,f,e,u,n);var p=this.bookLineOf(e)-f;const d=n(p);var g=0;if(h)for(var v=h,m=p,b=d;v>0&&(g+=this.tokenizer.isConcatable(b)?0:1,m--,b=n(m));)v-=b.length;var k=i.trimRight.call(this,d,this.charOf(e),s).length;const y=n(this.bookLineOf(u)-f);var T=i.trimRight.call(this,y,l).length;return{line:c,ch:k+h-T+g}},a=function(t,e,n){var r=i.parseRange.call(this,e),o=s.call(this,t,r.start,n,!0,!0);if(r.end>r.start){var a=s.call(this,t,r.end,n,!1);r.start==r.end&&(o=a),a.line==o.line&&a.ch<o.ch&&(a.ch=o.ch)}else a=o;return{start:o,end:a}},c=function(e,n,r,o,s,a){const c=this.bookLineOf(r)||0;var u=s(c-o);const l=n.ch;if(!u)return 1;var f=this.charOf(r)?i.trimRight.call(this,u,this.charOf(r),!0).length:0;if(u.length-f>=l||a){const h=r+this.kcount(e.substr(0,l));return h}u=u.substr(f);for(var p=c;l>u.length;)if(l-=u.length,++p,u=s(p-o),"undefined"==typeof u)return r;return t=u.substr(0,l),i.advanceLineChar.call(this,r,p-c,t)};n.exports={toLogicalPos:s,toLogicalRange:a,fromLogicalPos:c}},{"./bsearch":42,"./textutil":55}],44:[function(t,e){const n=(t("./bsearch"),t("./ksanapos")),r=t("./ksanacount"),i=t("./tokenizer").createTokenizer,o=t("./textutil"),s=t("./coordinate"),a=t("./toc"),c=t("./gettext"),u=t("./getfield"),l=t("./tpos"),f=t("./article"),h=t("./group"),p=function(t){return o.parseRange.call(this,t,this.addressPattern)},d=function(t,e){const r=this.addressPattern;return e?n.stringify(n.makeRange(t,e,r),r,!0):n.stringify(t,r)},g=function(t,e){return n.makeRange(t,e,this.addressPattern)},v=function(t){return n.makeKPos(t,this.addressPattern)},m=function(t){return"number"==typeof t?n.isRange(t,this.addressPattern):n.isRange(n.parse(t,this.addressPattern),this.addressPattern)},b=function(t,e){return t.indexOf(u.BILINKSEP+e.id)>0},k=function(t){t.addressPattern=n.buildAddressPattern(t.meta.bits,t.meta.column),t.tokenizer=i(t.meta.versions.tokenizer),t.getArticle=f.getArticle,t.getField=u.getField,t.getGField=u.getGField,t.getBookField=u.getBookField,t.getArticleField=u.getArticleField,t.getArticleFields=u.getArticleFields,t.trimField=u.trimField,t.getFieldNames=u.getFieldNames,t.findAField=u.findAField,t.getPages=c.getPages,t.getText=c.getText,t.articleOf=f.articleOf,t.bookOf=o.bookOf,t.pageOf=o.pageOf,t.pageStart=o.pageStart,t.lineOf=o.lineOf,t.charOf=o.charOf,t.stringify=d,t.makeRange=g,t.makeKPos=v,t.parseRange=p,t.isRange=m,t.getArticleText=c.getArticleText,t.getArticleTextTag=c.getArticleTextTag,t.getArticleName=f.getArticleName,t.articleCount=f.articleCount,t.extractKPos=o.extractKPos,t.toLogicalRange=s.toLogicalRange,t.toLogicalPos=s.toLogicalPos,t.fromLogicalPos=s.fromLogicalPos,t.layoutText=o.layoutText,t.bookLineOf=o.bookLineOf,t.getTOC=a.getTOC,t.addressRegex=/@([\dpabcd]+-[\dabcd]+);?/g,t.kcount=r.getCount(t.tokenizer),t.koffset=r.getOffset(t.tokenizer),t.kskiptoken=r.getSkipToken(t.tokenizer,t.meta.removePunc),t.tPosToKRange=l.tPosToKRange,t.groupNames=h.groupNames,t.groupKPoss=h.groupKPoss,t.groupTPoss=h.groupTPoss,t.groupKRange=h.groupKRange,t.groupTRange=h.groupTRange,t.groupArticles=h.groupArticles,t.getTitle=h.getTitle,t.getGroupName=h.getGroupName,t.groupOf=h.groupOf,t.getGroupTOC=a.getGroupTOC,t.cachedSubTOC={},t.cachedTOC=[],t.fromTPos=l.fromTPos,t.cachedPostings={},t.url=t.kdb.url,t.linkingTo=b};e.exports={init:k}},{"./article":41,"./bsearch":42,"./coordinate":43,"./getfield":47,"./gettext":48,"./group":49,"./ksanacount":51,"./ksanapos":52,"./textutil":55,"./toc":56,"./tokenizer":57,"./tpos":60}],45:[function(t,e){const n=t("ksana-corpus-rom"),r=t("./corpus"),i=t("./regcor");var o="",s={};const a=function(t){var e=s[t];e&&(e.kdb.free(),delete s[t])},c=function(e,n,o,s){"function"==typeof o&&(s=o,o={});var a={kdb:n};a.get=t("./get"),a.local=n.local,a.expandVariant=o.expandVariant||function(t){return t},n.fs.mergePostings&&(a.mergePostings=n.fs.mergePostings.bind(n.fs)),o.preload=o.preload||[];var c=[["meta"],["gfields"],["fields","tocrange"]];o.textOnly||c.push(["inverted","book2tpos"],["inverted","article2tpos"],["inverted","tokens"],["inverted","posting_length"],["inverted","group2tpos"]),"undefined"!=typeof window&&(console.log("loading "+e),console.time("preload")),o.preload.forEach(function(t){c.push(t)}),a.get(c,{recursive:!0},function(t){"undefined"!=typeof window&&console.timeEnd("preload"),a.meta=t[0],a.meta.displayOptions||(a.meta.displayOptions={}),a.id=e,a.registered=!!i[a.id],r.init(a),s(0,a)})},u=function(t,e,n,r){c(t,e,n,function(e,n){o="",e?r(e):n&&n.meta?(s[t]=n,r&&r(0,n)):r&&r(t+" is invalid")})},l=function(t,e,n){"function"==typeof e&&(n=e,e={});var r=0,i=s[t];return i?(n&&n(0,i),i):o?void(r=setInterval(function(){o||(clearInterval(r),h(t,e,n))},200)):h(t,e,n)},f=function(){return"undefined"!=typeof process&&process.versions&&process.versions.node},h=function(t,e,r){var i=s[t];if(i)return r&&r(0,i),i;var a,c=t;o=t,e=e||{};const l="undefined"!=typeof window&&"chrome-extension:"==window.location.protocol;if("string"==typeof c&&"blob:"!==c.substr(0,5)){if(-1==c.indexOf(".cor")&&(c+=".cor"),!l)if("undefined"!=typeof window&&window.node_modules||f())a="../"+t+"-corpus/"+c;else{const h=c;c=t+"-corpus/"+c,a=h}o=t}else c.name?(t=c.name.replace(/\..+$/,""),o=t):o=c.lastIndexOf?c.substr(c.lastIndexOf("/")+1):c;new n.open(c,function(i,s){i?"string"==typeof a&&new n.open(a,function(n,i){n?(o="",r&&r(n)):u(t,i,e,r)}):u(t,s,e,r)})},p=function(){return!!o};e.exports={open:l,close:a,isBusy:p}},{"./corpus":44,"./get":46,"./regcor":54,"ksana-corpus-rom":25}],46:[function(t,e){var n=function(t,e,n){if(t){"string"==typeof t&&(t=[t]);var r=this,i=[],o=[];e.syncable&&(e.syncable=!1);for(var s=function(t){return function(n){n&&"object"==typeof n&&n.__empty||i.push(n),r.get(t,e,o.shift())}},a=0;a<t.length;a++)"null"==typeof t[a]?i.push(null):o.push(s(t[a]));o.push(function(e){i.push(e),n.apply(r.context||r,[i,t])}),o.shift()({__empty:!0})}},r=function(t,e,r){var i=this;return"function"==typeof e&&(context=r,r=e,e={recursive:!1}),e=e||{},t?"function"!=typeof r?"object"==typeof t[0]?t.map(function(t){return i.kdb.get(t,e)}):i.kdb.get(t,e):("string"==typeof t&&(t=[t]),"string"==typeof t[0]?i.kdb.get(t,e,function(e){r(e,i,t)}):"object"==typeof t[0]?n.call(i,t,e,function(e){r(e,i,t)}):void i.kdb.get([],e,function(t){r(t,i)})):(r&&r([null]),null)};e.exports=r},{}],47:[function(t,e){const n=t("./bsearch"),r="<",i=function(t,e){return"object"==typeof t?o.call(this,"fields",t,e):this.get(["fields",t],{recursive:!0},e)},o=function(t,e){const n=t.map(function(t){return["fields",t]});return this.get(n,{recursive:!0},e)},s=function(t,e){return this.get(["gfields",t],{recursive:!0},e)},a=function(t,e,n){return"object"==typeof t?c.call(this,t,e,n):this.get(["fields",t,e],{recursive:!0},n)},c=function(t,e,n){const r=t.map(function(t){return["fields",t,e]});return this.get(r,{recursive:!0},n)},u=function(t,e,n){var r=t;"number"==typeof t&&(r=this.getArticle(t));var i=e;"string"==typeof e&&(i=[e]);const o=i.map(function(t){return["afields",r.at,t]});return this.get(o,{recursive:!0},n)},l=function(t,e){var n=t;"number"==typeof t&&(n=this.getArticle(t));const i=this.get("gfields");var o={};for(var s in i)s.indexOf(r)>0&&(o[s]=d.call(this,i[s],n.start,n.end));return this.get(["afields",n.at],{recursive:!0},function(t){e(Object.assign(o,t))}.bind(this))},f=function(t){const e=this.get(["fields"],function(e){return t(Object.keys(e))});return e?Object.keys(e):[]},h=function(t,e,r){this.meta.invertAField&&this.meta.invertAField[t]&&this.getField([t+"_start",t+"_end"],function(i){const o=i[0],s=i[1];var a=0;for(a=0;a<o.value.length&&!(e>=o.value[a]&&e<=s.value[a]);a++);return a==o.value.length?void r(0,"address not found"):void this.getArticleField(a,t,function(t){const i=n(t.value,e);i>0?r(0,t.pos[i-1]):r("address "+e+" not found in article"+at)})}.bind(this))},p=function(t,e,r){var i={};const o=n(t.pos,e+1,!0),s=n(t.pos,r,!0);for(var a in t)i[a]=t[a].slice(o,s);return i},d=function(t,e,r){var i={};const o=this.makeRange(e,e),s=this.makeRange(r,r),a=n(t.pos,o+1,!0),c=n(t.pos,s,!0);for(var u in t)i[u]=t[u].slice(a,c);return i};e.exports={getField:i,getFields:o,getGField:s,getBookFields:c,getBookField:a,getArticleField:u,getArticleFields:l,getFieldNames:f,BILINKSEP:r,findAField:h,trimField:p,trimRangeField:d}},{"./bsearch":42}],48:[function(t,e){const n=t("./ksanapos"),r=t("./textutil"),i=function(t,e){return["texts",e[0]-1]},o=function(t,e,n,r){var i,o=[],s=t[0]-1,a=t[1],c=e[1];for(e[0]>t[0]&&(c=r),i=a;c>=i&&!(i>=r);i++)o.push(["texts",s,i]);return o},s=function(t,e,n){var i,o=[];const s=r.parseRange.call(this,t,this.addressPattern,!0),a=this.addressPattern;var c=s.startarr[1],u=s.endarr[1];const l=s.startarr[2];for(s.endarr[0]>s.startarr[0]&&(u=c+e.length),i=c;u>=i;i++)if("undefined"!=typeof e[i-c]){var f=JSON.parse(JSON.stringify(e[i-c]));if(i!=u)for(;f.length<a.maxline;)f.push("");const h=!!this.get("meta").removePunc;i==u&&s.endarr[2]+1<f.length&&(f.length=s.endarr[2]+1,f[f.length-1]=r.trimRight.call(this,f[f.length-1],s.endarr[3],h)),i==c&&(f=f.slice(l),s.startarr[3]&&(f[0]=r.trimLeft.call(this,f[0],s.startarr[3],!1))),o=o.concat(f)}for(;o.length&&!o[o.length-1];)o.pop();return n&&n(o),o},a=function(t,e){const n=r.parseRange.call(this,t,this.addressPattern,!0),s=this.addressPattern.column,a=i(n.startarr,n.endarr,s),c=function(t){if(!t)return void(e&&e([]));const r=t.length;var i=o(n.startarr,n.endarr,s,r),a=!1;1==i.length&&(a=!0,i=i[0]);var c=function(t){e(a?[t]:t)};e||(c=null);const u=this.get(i,{recursive:!0,syncable:!0},c);return a?[u]:u},u=this.get(a,{syncable:!0},function(t){c.call(this,t)}.bind(this));return u?c.call(this,u):u},c=function(t,e){if("object"==typeof t)return f.call(this,t,e);var n=null,r=function(r){n=setTimeout(function(){s.call(this,t,r,e)}.bind(this),1)}.bind(this);e||(r=null);var i=a.call(this,t,r);return"undefined"!=typeof i&&"string"!=typeof i&&"undefined"!=typeof i[0]?(clearTimeout(n),s.call(this,t,i,e)):void 0},u=function(t,e){const r=this.getArticle(t);if(!r)return e(null),null;var i=n.makeRange(r.start,r.end,this.addressPattern);return c.call(this,i,e)},l=function(t,e){const r=this.getArticle(t);if(!r)return e(null),null;var i=n.makeRange(r.start,r.end,this.addressPattern);c.call(this,i,function(t){return t?void this.getArticleFields(r.at,function(n){e({text:t,fields:n})}):(e(null),null)}.bind(this))},f=function(t,e){if(!t||!t.length)return void e([]);var n=[],r=JSON.parse(JSON.stringify(t));const i=function(t){c.call(this,t,function(t){n.push(t),r.length?i.call(this,r.shift()):e(n)}.bind(this))};i.call(this,r.shift())};e.exports={getText:c,getArticleText:u,getArticleTextTag:l,getPages:a}},{"./ksanapos":52,"./textutil":55}],49:[function(t,e){const n=t("./bsearch"),r=function(){return this.get(["gfields","group","value"])||this.get(["gfields","article","value"])},i=function(){return this.get(["gfields","group","pos"])||this.get(["gfields","article","pos"])},o=function(){return this.get(["inverted","group2tpos"])||this.get(["inverted","article2tpos"])},s=function(t){const e=i.call(this),n=this.meta.endpos,r=e[t],o=e[t+1];return r?o?[r,o]:[r,n]:[0,n]},a=function(t){const e=o.call(this),n=this.meta.endtpos,r=e[t],i=e[t+1];return r?i?[r,i]:[r,n]:[0,n]},c=function(t){var e;if("number"==typeof t)e=t;else{const r=this.parseRange(t);e=r.start}{const i=this.groupKPoss.call(this),o=n(i,e+10,!0)-1,s=this.groupKRange.call(this,o),a=this.get(["gfields","article","pos"]);this.get(["gfields","article","value"])}for(var c=[],u=0;u<a.length;u++){const l=a[u];l>=s[0]&&l<s[1]&&c.push(this.getArticle(u))}return c},u=function(t,e){const n=l.call(this,t),r=this.articleOf(t);return n+(e||"-")+r.articlename},l=function(t,e){const n=this.groupNames();if(!n)return"";const r=f.call(this,t);var i=n[r]||"";return i=e?i.substr(0,i.indexOf(";")):i.substr(i.indexOf(";")+1)},f=function(t){const e=this.parseRange(t),r=e.start,i=this.groupKPoss.call(this);const o=i?n(i,r+10,!0)-1:0;return o};e.exports={groupNames:r,groupKPoss:i,groupTPoss:o,groupKRange:s,groupTRange:a,groupArticles:c,getTitle:u,getGroupName:l,groupOf:f}},{"./bsearch":42}],50:[function(t,e){const n=t("./engine"),r=t("./bsearch"),i=t("./article").trimArticleField,o=function(t){n.close(t)},s=function(t,e,r){if("function"==typeof e&&(r=e,e={}),!(t instanceof Array))return n.open(t,e,r);for(var i=0;i<t.length;i++)n.open(t[i],e);const o=setInterval(function(){n.isBusy()||(clearInterval(o),r&&r())},100)},a=t("./parselink"),c=t("./textutil"),u=t("./ksanapos"),l=t("./regcor"),f=function(t,e){return"string"==typeof e&&(e=l[e]),e?c.parseRange(krange,e):null},h=function(t,e){return"string"==typeof e&&(e=l[e]),e?u.stringify(t,e):""};e.exports={openCorpus:s,closeCorpus:o,bsearch:r,parseLink:a,trimArticleField:i,parseRange:f,stringifyRange:h,regcor:l}},{"./article":41,"./bsearch":42,"./engine":45,"./ksanapos":52,"./parselink":53,"./regcor":54,"./textutil":55}],51:[function(t,e){const n=t("./tokenizer").concreteToken,r=t("./tokentypes").TokenTypes.PUNC,i=function(t){return function(e){const r=t.tokenize(e);for(var i=0,o=0;o<r.length;o++)n[r[o][2]]&&i++;return i}},o=function(t,e){return function(i,o){const s=t.tokenize(i);for(var a=0,c=0;o&&a<s.length;){const u=s[a];n[u[2]]&&(c++,o--),e||u[2]!=r||o--,a++}return c}},s=function(t){return function(e,r,i){if(!e)return 0;const o=t.tokenize(e);var s=0;if(r)for(;s<o.length&&!n[o[s][2]];)s++;for(;r&&s<o.length;)n[o[s][2]]&&r--,s++;for(;i&&s<o.length&&!n[o[s][2]];)s++;return s<o.length?o[s][1]:o[o.length-1]?o[o.length-1][1]+o[o.length-1].length:0}};e.exports={getCount:i,getOffset:s,getSkipToken:o}},{"./tokenizer":57,"./tokentypes":59}],52:[function(t,e){var n=function(){var t=Array.prototype.slice.call(arguments);"error"==t[0]?(t.shift(),console.error.apply(null,t)):"warn"==t[0]?console.warn.apply(null,t):console.log.apply(null,t)};const r=function(t){n=t},i=function(t,e){const r=t[0],i=t[1],o=t[2],s=t[3];if(2*s+2*o+2*i+r>53)throw"address has more than 53 bits";if(o>6||s>8)throw n("error",o,s),"max line/char bits is 6 and 8";const a=1<<s,c=1<<o,u=1<<i,l=1<<r;var f=s+o+i;const h=1<<f,p=[r,i,o,s],d=r+i+o+s;return{maxbook:l,maxpage:u,maxline:c,maxchar:a,maxrange:h,bits:p,kposbits:d,bookbits:r,pagebits:i,linebits:o,charbits:s,rangebits:f,column:e}};var o=function(t,e){return t[3]>=e.maxchar?0:t[2]>=e.maxline?0:t[1]>=e.maxpage?0:t[0]>=e.maxbook?0:1},s=function(t,e){var r,i=1,s=0;for(r=0;r<t.length;r++)if(t[r]<0)return n("error","makeKPos:","negative value",t[r],JSON.stringify(t)),-1;var a=!1;return o(t,e)||(a=!0,t[2]>=e.maxline&&(t[2]=e.maxline-1),t[3]>=e.maxchar&&(t[3]=e.maxchar-1)),s=t[3],i*=Math.pow(2,e.charbits),s+=t[2]*i,i*=Math.pow(2,e.linebits),s+=t[1]*i,i*=Math.pow(2,e.pagebits),s+=t[0]*i,a&&n("error","kpos trimmed",l(s,e),JSON.stringify(t)),s};const a=function(t,e,n){if(n||f(t,e)){var r=Math.pow(2,e.rangebits),i=Math.floor(t%r);return start=Math.floor(t/r),end=start+i,{start:start,end:end}}return{start:t,end:t}},c=function(t,e,n){if(isNaN(t)||isNaN(e))return 0;if(t>e){const r=t;t=e,e=r}var i=e-t;i>n.maxrange&&(i=n.maxrange-1);const o=Math.pow(2,n.rangebits);return i>=o&&(i=o-1),t*o+i};var u=function(t,e){var n=t%e.maxchar,r=Math.floor(t/e.maxchar%e.maxline),i=Math.floor(t/Math.pow(2,e.charbits+e.linebits)%e.maxpage),o=Math.floor(t/Math.pow(2,e.charbits+e.linebits+e.pagebits)%e.maxbook),s=[o,i,r,n];return s};const l=function(t,e){const n=u(t,e);var r=n[0]+"p";return e.column?(r+=Math.floor(n[1]/e.column)+1,r+=String.fromCharCode(n[1]%e.column+97)):(r+=n[1]+1,r+="."),line="0"+(n[2]+1),r+=line.substr(line.length-2),ch=e.charbits>6?"0"+n[3].toString(16).toUpperCase():"0"+n[3],r+=ch.substr(ch.length-2)},f=function(t,e){return t/Math.pow(2,e.kposbits)>1},h=function(t,e){if(f(t,e)){const n=a(t,e);var r=l(n.end,e),i=r.indexOf("p");r=r.substr(i+1);const o=l(n.start,e),s=u(n.start,e),c=u(n.end,e);return s[1]!==c[1]?e.column&&Math.floor(s[1]/e.column)==Math.floor(c[1]/e.column)?o+"-"+r.substr(r.length-5):o+"-"+r:s[2]!==c[2]?o+"-"+r.substr(r.length-4):s[3]!==c[3]?o+"-"+r.substr(r.length-2):o}return l(t,e)},p=function(t,e,n,r){if(e.length<3){var i=10;n&&r.charbits>6&&(i=16),t[n?3:2]=parseInt(e,i)-(n?0:1)}else t[2]=parseInt(e.substr(0,2),10)-1,t[3]=parseInt(e.substr(2,2),r.charbits>6?16:10)},d=/(\d+)([a-d\.])([A-F\d]+)/,g=/([a-d])([A-F\d]+)/,v=/([A-F\d]+)/,m=function(t,e,r){var i=t.match(d),o=s(r,e);if(i)r[1]=parseInt(i[1],10)-1,e.column&&(r[1]=r[1]*e.column+(parseInt(i[2],36)-10)),p(r,i[3],!1,e);else if(i=t.match(g))r[1]=Math.floor(r[1]/3),r[1]=r[1]*e.column+(parseInt(i[1],36)-10),p(r,i[2],!0,e);else{if(i=t.match(v),!i)return o;p(r,i[1],!0,e)}var a=s(r,e);return o>a?(n("error","end bigger than start",JSON.stringify(r)),o+1):a},b=/(\d+)p(\d+)([a-d\.])([A-F\d]+)/,k=/(\d+)p(\d+)([a-d]?)/,y=function(t,e){var n=t.match(b);if(n||(n=t.match(k)),!n)return null;var r=[0,0,0,0];if(r[0]=parseInt(n[1],10),r[1]=parseInt(n[2],10)-1,e.column){var i="."!=n[3]&&n[3]?n[3]:"a";r[1]=r[1]*e.column+(parseInt(i,36)-10)}n.length>4&&p(r,n[4],!1,e);var o=s(r,e),a=o;const u=t.indexOf("-");return u>-1&&(remain=t.substr(u+1),a=m(remain,e,r)),c(o,a,e)},T=function(t,e){var n=u(t,e);return n[2]=0,n[3]=0,s(n,e)};e.exports={parse:y,buildAddressPattern:i,makeKPos:s,isRange:f,makeRange:c,breakRange:a,unpack:u,stringify:h,bookStartPos:T,setLog:r}},{}],53:[function(t,e){const n=t("./engine").open,r=function(t,e){const r=t.split("@");if(2!==r.length)return e&&e(null),null;if("Taisho"!=r[0]){const i={corpus:r[0],address:r[1]};return e&&e(i),i}return n(r[0].toLowerCase(),function(t){if(t)return e&&e(null),null;const n=r[1].split("p");console.log("taisho number",n[0],"number",n[1])}),null};e.exports=r},{"./engine":45}],54:[function(t,e){const n=t("./ksanapos"),r=n.buildAddressPattern,i=r([7,10,5,8]);var o={"default":i,manual:i,demo:i,pts:r([7,10,6,6]),yinshun:r([7,11,5,6]),taisho:r([6,13,5,5],3),nanchuan:r([7,10,4,6]),taixu:r([5,12,6,6]),j13zs:r([4,13,4,6],4),mpps:r([1,12,6,8])};e.exports=o},{"./ksanapos":52}],55:[function(t,e){const n=t("./ksanapos"),r=t("./tokentypes"),i=r.TokenTypes,o=function(t){const e=this.tokenizer.code2TokenType;return e[t]===i.PUNC||e[t]===i.SPACE},s=function(t,e,n){if(!t)return"";var r,i=e,o=0,s=t;return r=this.koffset(s,i,n),o+=r,t.substr(0,o)},a=function(t,e,n){if(!t)return"";var r,i=e,o=0,s=t;return r=this.koffset(s,i,n),o+=r,t.substr(o)},c=function(t,e,n,r){for(var i,o=0,a=0,c=[],u="",f=[],h=[],p=[],d=e,g=0,v=0;v<t.length;v++){if(i=l.call(this,e,v+1),o=this.pageOf(d)-1,a!==o){for(;c.length>0&&!c[c.length-1].trim();)h.pop(),c.pop(),f.length&&f.pop();p.push(d)}if(n){for(var m=0,b=(t[v],0);g<n.length&&i>n[g];){m++;const k=s.call(this,t[v],n[g]-d,!0);c.push(u+k.substr(b)),b=k.length,u="",g++}if(m)u=t[v].substr(b);else{const y=this.tokenizer.isConcatable(t[v])?"":" ";u+=y+t[v]}}else c.push(t[v].replace(/\r?\n/g," ")),r&&f.push(r[v]),h.push(d);a=o,d=i}return n&&(h=n,h.unshift(e),c.push(u)),r&&f.push(r[r.length-1]),{linebreaks:h,pagebreaks:p,lines:c,linetpos:f}},u=function(t){var e={},r=this.addressPattern,i=this.articleOf.bind(this);return t.replace(this.addressRegex,function(t,o){const s=n.parse(o,r);if("undefined"!=typeof s){var a=i(s);if(!a.articlename)return;e[a.articlename]||(e[a.articlename]=[]),e[a.articlename].push(s)}}),e},l=function(t,e,r){const i=this.addressPattern;if(t+=e*i.maxchar,r){var o=n.unpack(t,i);return o[3]=this.kcount(r),n.makeKPos(o,i)}return t},f=function(t,e){"undefined"==typeof e&&(e=this.addressPattern),"string"==typeof t&&(t=n.parse(t,e));const r=n.breakRange(t,e),i=n.unpack(r.start,e);var o=n.unpack(r.end,e);return{startarr:i,endarr:o,start:r.start,end:r.end,range:t}},h=function(t,e){e=e||this.addressPattern;const r=n.unpack(t,e);return r},p=function(t){const e=f(t,this.addressPattern),n=h.call(this,e.start);return n[0]},d=function(t){const e=f(t,this.addressPattern),n=h.call(this,e.start);return n[1]},g=function(t){const e=f(t,this.addressPattern),n=h.call(this,e.start);return n[1]*this.addressPattern.maxline+n[2]},v=function(t){const e=f(t,this.addressPattern),n=h.call(this,e.start);return n[2]},m=function(t){const e=f(t,this.addressPattern),n=h.call(this,e.start);return n[3]},b=function(t){const e=f(t,this.addressPattern),r=h.call(this,e.start),i=this.addressPattern;return r[2]=0,r[3]=0,n.makeKPos(r,i)};e.exports={trimLeft:a,trimRight:s,parseRange:f,bookOf:p,pageOf:d,lineOf:v,charOf:m,pageStart:b,bookLineOf:g,layoutText:c,isPunc:o,extractKPos:u,advanceLineChar:l}},{"./ksanapos":52,"./tokentypes":59}],56:[function(t,e){const n=function(t,e,n,r){return t>=n&&r>e||n>t&&e>r},r=function(t,e){if(t=parseInt(t)||0,0>t)return void(e&&e([]));const r=this.groupKRange(t),i=this.getGField("article").value,o=this.getField("tocrange");if(!o)return void(e&&e([]));for(var s=[],a=[],c=0;c<o.value.length;c++)n(o.pos[c],o.value[c],r[0],r[1])&&(a.push("0	"+i[c]+"	"+o.pos[c].toString(36)),s.push(["fields","toc","value",c]));console.log(s),this.get(s,function(n){var i=[],o=this.groupNames()[t];o||(o=""),o=o.substr(o.indexOf(";")+1),i.push("0	"+o+"	"+r[0].toString(36));for(var s=0;s<n.length;s++)i=i.concat(n[s]);console.log(i.length),e(i)}.bind(this))},i=function(t,e){const n=this.getField("tocrange");if(!n)return[];for(var r=[],i=[],o=!1,s=0;s<n.pos.length;s++){const a=n.pos[s],c=n.value[s];t>=a&&c>t&&(this.cachedTOC[s]?i.push(this.cachedTOC[s]):(o=!0,r.push(["fields","toc","value",s])))}if(!o)return e&&e(i),i;const u=function(t){for(var e=[],n=0;n<t.length;n++){const r=t[n].split("	");e.push({d:parseInt(r[0],10),t:r[1],p:parseInt(r[2],36)})}return e};this.get(r,{recursive:!0},function(t){for(var n=0;n<r.length;n++){const o=r[n][3];this.cachedTOC[o]=u(t[n]),i.push(this.cachedTOC[o])}e(i)}.bind(this))};e.exports={getTOC:i,getGroupTOC:r}},{}],57:[function(t,e){const n=t("./tokentypes"),r=n.TokenTypes;var i=function(t){for(var e=0,n=0;1!==e&&n<t.length;){var r=t.charCodeAt(n);r>=12272&&12283>=r?(e--,(12274===r||12275===r)&&e--):e++,n++}return n};const o=function(t){const e=this.code2TokenType;for(var n,o=0,s=[];o<t.length;){n="","\n"==t[o]&&(s.push([t[o],o,r.SPACE]),o++);var a=e[t.charCodeAt(o)];if(a!=r.SURROGATE)if(a!==r.IDC)if(a!==r.CJK&&a!==r.PUNC)if(a!==r.TIBETAN&&a!==r.LATIN&&a!==r.NUMBER){if(a=r.SPACE,a===r.SPACE){for(var c=o;o<t.length;){n+=t.substr(o,1),o++;var u=t.charCodeAt(o),a=e[u];if(a!==r.SPACE||"\n"==t[o])break}n&&s.push([n,c,r.SPACE])}}else{n=t.substr(o,1),s.push([n,o,a]),o++;for(var l=a;o<t.length;){var u=t.charCodeAt(o),a=e[u];if(a!=l)break;n+=t.substr(o,1),o++}s[s.length-1][0]=n}else n=t.substr(o,1),s.push([n,o,a]),o++;else{var f=i(t.substr(o));n=t.substr(o,f),s.push([n,o,a]),o+=f}else n=t.substr(o,2),s.push([n,o,a]),o+=2}return s},s=function(t){const e=n.getCode2TokenTypeMap(t),i=function(t){if(!t)return!0;const n=e[t.charCodeAt(0)];return n==r.CJK||n==r.TIBETAN||n==r.IDC||n==r.PUNC||n==r.SPACE};return{tokenize:o,TokenTypes:r,version:t,code2TokenType:e,isConcatable:i}},a={};a[r.SURROGATE]=!0,a[r.CJK]=!0,a[r.NUMBER]=!0,a[r.TIBETAN]=!0,a[r.LATIN]=!0,a[r.IDC]=!0,e.exports={createTokenizer:s,parseIDS:i,latest:2,concreteToken:a}},{"./tokentypes":59}],58:[function(t,e){e.exports="48 10N7 26A6 26A86 1A31 1A14 128A3488 20N12 128T3648 256A256 112P3600 352C16 15I2 63P192C768 27648C14336 257S8191 512P1025 1P6 2P2 1P1 1P11 2P3 1P65 1P2 2P154 "},{}],59:[function(t,e){const n={SPACE:" ",LINEBREAK:"B",SURROGATE:"S",CJK:"C",NUMBER:"N",TIBETAN:"T",LATIN:"A",IDC:"I",PUNC:"P"};var r=[];const i=function(t){var e=0,n="";return t.replace(/(\d+)(.)/g,function(t,r,i){for(e=0;e<parseInt(r,10);e++)n+=i}),n},o=function(){const e=i(t("./tokentypemap"));if(65536!==e.length)throw"token map unpack error";r=e.split(""),Object.freeze(r)},s=function(){return r.length||o(),r};e.exports={TokenTypes:n,getCode2TokenTypeMap:s}},{"./tokentypemap":58}],60:[function(t,e){const n=t("./bsearch"),r=t("./ksanapos"),i=(t("./tokentypes").TokenTypes,function(t,e,n,i){for(var o=r.unpack(t,this.addressPattern);i;){if(o[2]>0)o[2]--,n--;else{for(n--;n>0&&e[n]==e[n-1];)n--;const s=n%this.addressPattern.maxline;o[1]--,o[2]=s}i--}const a=r.makeKPos(o,this.addressPattern);return{kpos:a,at:n}}),o=function(t,e,n,i){for(var o=r.unpack(t,this.addressPattern);i>0;){for(;n<e.length-1&&e[n]==e[n+1];)n++;n++;const s=n%this.addressPattern.maxline;s<o[2]&&o[1]++,o[2]=s,i--}const a=r.makeKPos(o,this.addressPattern);return{kpos:a,at:n}},s=function(t,e,n,r){return t*r+e*n},a=function(t,e,n){const r=n%this.addressPattern.maxline,i=n+(this.addressPattern.maxline-r)-1;if(t[n]==t[i])for(;n>0&&t[n-1]==t[n];)n--;return n},c=function(t,e,r,c,u,l){const f=Math.pow(2,this.addressPattern.charbits),h=Math.pow(2,this.addressPattern.rangebits),p=(!!this.get("meta").removePunc,function(t){if(c[0]instanceof Array)for(var e=0;e<c.length&&!(t>=c[e][0]&&t<=c[e][1]);e++);else{for(var e=0;e<c.length&&!(c[e]>t);e++);e&&e--}const n=r[e];return n});for(var d=[],g=[],v=[],m=0;m<t.length;m++){const b=u[l[m]];if(b){var k=n(b,t[m],!0);b[k]>t[m]&&k--;var y=b[k+1];if(k=a.call(this,b,l[m],k,f,h),!(0>k)){g.push([b,k]);var T=s(l[m],k,f,h);if(r){const x=t[m]-b[k],A=(r instanceof Array?p(t[m],b):r)||"";T+=this.kskiptoken(A,x)}d.push(T),v.push([b[k],y])}}}var P={kpos:d,linetpos:v};if(e){var w=[];e>2&&(v=[]);for(var m=0;m<d.length;m++){var E=d[m],O=E;const b=g[m][0],k=g[m][1];if(e>2){var F=Math.floor((e-1)/2);F>2&&(F=2);const I=i.call(this,E,b,k,F),S=o.call(this,E,b,k,F);E=I.kpos,O=S.kpos;for(var _=[],N=I.at;N<=S.at;N++)_.push(b[N]);_.push(b[S.at+1]),v.push(_)}const C=O+this.addressPattern.maxchar-1,R=this.makeRange(E,C);w.push(R)}P={kpos:d,linekrange:w,line:e,linetpos:v}}return P},u=function(t,e){for(var n=[],i=0;t>i;i++){const o=r.unpack(kpos,this.addressPattern),s=e[o[0]],a=o[1]*this.addressPattern.maxline+o[2];n.push(s[a])}return n},l=function(t,e){t instanceof Array||(t=[t]);for(var n=[],i=[],o={},s=0;s<t.length;s++){const a=r.unpack(t,this.addressPattern),c=a[0];bookof.push(a[0]),o[c]=!0}for(c in o)n.push(["inverted","line2tpos",c]),
i.push(c);var l={};if(!e){const f=this.get(n);if(!f)return console.error("async get fail , kpos",t,"keys",n),null;for(var s=0;s<f.length;s++)l[i[s]]=f[s];return u.call(this,t,l)}this.get(n,function(n){for(var r=0;r<n.length;r++)l[i[r]]=n[r];e&&e(u.call(this,t,l))}.bind(this))},f=function(t,e,r){var i=t;if("function"==typeof e&&(r=e,e={}),e=e||{},"number"==typeof t&&(i=[t]),!i.length)return r&&r(),{kpos:[]};const o=this.get(["inverted","book2tpos"]);for(var s={},a=[],u=[],l=[],f={},h=0;h<i.length;h++){var p=n(o,i[h],!0);a.push(p),f[p]=!0}for(var p in f)u.push(["inverted","line2tpos",p]),l.push(p);if(!r){const d=this.get(u);if(!d||!d[0])return{kpos:[]};for(var h=0;h<d.length;h++)s[l[h]]=d[h];return c.call(this,i,e.line,e.linetext,e.linetpos,s,a)}this.get(u,function(t){for(var n=0;n<t.length;n++)s[l[n]]=t[n];r&&r(c.call(this,i,e.line,e.linetext,e.linetpos,s,a))}.bind(this))},h=function(t,e,n){var r=[];"function"==typeof e&&(n=e,e={});const i=f.call(this,t,e,function(){n&&n(r)}.bind(this));return n?void 0:i};e.exports={fromTPos:f,tPosToKRange:h,toTPos:l}},{"./bsearch":42,"./ksanapos":52,"./tokentypes":59}]},{},[2]);